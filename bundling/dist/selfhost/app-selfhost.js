!function(e){var t={};function r(i){if(t[i])return t[i].exports;var o=t[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(i,o,function(t){return e[t]}.bind(null,o));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=23)}([function(e,t,r){var i=r(2),o=r(1),n=o.StorageNames,a=/\+/g;function s(e){var t=Object.prototype.toString.call(e);return"[object Object]"===t||"[object Error]"===t}function c(e,t){var r=0;if(Array.prototype.indexOf)return e.indexOf(t,0)>=0;for(var i=e.length;r<i;r++)if(r in e&&e[r]===t)return!0}function u(e){var t=0,r=0;if(null==e)return 0;if(e=e.toString().toLowerCase(),Array.prototype.reduce)return e.split("").reduce(function(e,t){return(e=(e<<5)-e+t.charCodeAt(0))&e},0);if(0===e.length)return t;for(r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t&=t;return t}var l={isValidAttributeValue:function(e){return void 0!==e&&!s(e)&&!Array.isArray(e)},isValidKeyValue:function(e){return Boolean(e&&!s(e)&&!Array.isArray(e))},isStringOrNumber:function(e){return"string"==typeof e||"number"==typeof e},isFunction:function(e){return"function"==typeof e},validateIdentities:function(e,t){var r={userIdentities:1,onUserAlias:1,copyUserAttributes:1};if(e){if("modify"===t&&(s(e.userIdentities)&&!Object.keys(e.userIdentities).length||!s(e.userIdentities)))return{valid:!1,error:o.Messages.ValidationMessages.ModifyIdentityRequestUserIdentitiesPresent};for(var n in e)if(e.hasOwnProperty(n)){if(!r[n])return{valid:!1,error:o.Messages.ValidationMessages.IdentityRequesetInvalidKey};if("onUserAlias"===n&&!l.isFunction(e[n]))return{valid:!1,error:o.Messages.ValidationMessages.OnUserAliasType+typeof e[n]}}if(0===Object.keys(e).length)return{valid:!0};if(void 0===e.userIdentities)return{valid:!1,error:o.Messages.ValidationMessages.UserIdentities};if(null!==e.userIdentities&&!s(e.userIdentities))return{valid:!1,error:o.Messages.ValidationMessages.UserIdentities};if(s(e.userIdentities)&&Object.keys(e.userIdentities).length)for(var a in e.userIdentities)if(e.userIdentities.hasOwnProperty(a)){if(!1===i.IdentityType.getIdentityType(a))return{valid:!1,error:o.Messages.ValidationMessages.UserIdentitiesInvalidKey};if("string"!=typeof e.userIdentities[a]&&null!==e.userIdentities[a])return{valid:!1,error:o.Messages.ValidationMessages.UserIdentitiesInvalidValues}}}return{valid:!0}}};e.exports={canLog:function(){return!(!mParticle.Store.isEnabled||!mParticle.Store.devToken&&!mParticle.Store.webviewBridgeEnabled)},extend:function e(){var t,r,i,o,n,a,s=arguments[0]||{},c=1,u=arguments.length,l=!1,d={hasOwn:Object.prototype.hasOwnProperty,class2type:{},type:function(e){return null==e?String(e):d.class2type[Object.prototype.toString.call(e)]||"object"},isPlainObject:function(e){if(!e||"object"!==d.type(e)||e.nodeType||d.isWindow(e))return!1;try{if(e.constructor&&!d.hasOwn.call(e,"constructor")&&!d.hasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var t;for(t in e);return void 0===t||d.hasOwn.call(e,t)},isArray:Array.isArray||function(e){return"array"===d.type(e)},isFunction:function(e){return"function"===d.type(e)},isWindow:function(e){return null!=e&&e==e.window}};for("boolean"==typeof s&&(l=s,s=arguments[1]||{},c=2),"object"==typeof s||d.isFunction(s)||(s={}),u===c&&(s=this,--c);c<u;c++)if(null!=(t=arguments[c]))for(r in t)i=s[r],s!==(o=t[r])&&(l&&o&&(d.isPlainObject(o)||(n=d.isArray(o)))?(n?(n=!1,a=i&&d.isArray(i)?i:[]):a=i&&d.isPlainObject(i)?i:{},s[r]=e(l,a,o)):void 0!==o&&(s[r]=o));return s},isObject:s,inArray:c,createServiceUrl:function(e,t){var r,i=window.mParticle&&mParticle.Store.SDKConfig.forceHttps?"https://":window.location.protocol+"//";return r=mParticle.Store.SDKConfig.forceHttps?"https://"+e:i+e,t&&(r+=t),r},createXHR:function(e){var t;try{t=new window.XMLHttpRequest}catch(e){mParticle.Logger.error("Error creating XMLHttpRequest object.")}if(t&&e&&"withCredentials"in t)t.onreadystatechange=e;else if(void 0!==window.XDomainRequest){mParticle.Logger.verbose("Creating XDomainRequest object");try{(t=new window.XDomainRequest).onload=e}catch(e){mParticle.Logger.error("Error creating XDomainRequest object")}}return t},generateUniqueId:function e(t){return t?function(e){var t;return window.crypto&&window.crypto.getRandomValues&&(t=window.crypto.getRandomValues(new Uint8Array(1))),t?(e^t[0]%16>>e/4).toString(16):(e^16*Math.random()>>e/4).toString(16)}(t):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)},filterUserIdentities:function(e,t){var r=[];if(e&&Object.keys(e).length)for(var o in e)if(e.hasOwnProperty(o)){var n=i.IdentityType.getIdentityType(o);if(!c(t,n)){var a={Type:n,Identity:e[o]};n===mParticle.IdentityType.CustomerId?r.unshift(a):r.push(a)}}return r},filterUserIdentitiesForForwarders:function(e,t){var r={};if(e&&Object.keys(e).length)for(var o in e)e.hasOwnProperty(o)&&(c(t,i.IdentityType.getIdentityType(o))||(r[o]=e[o]));return r},filterUserAttributes:function(e,t){var r={};if(e&&Object.keys(e).length)for(var i in e)e.hasOwnProperty(i)&&(c(t,u(i))||(r[i]=e[i]));return r},findKeyInObject:function(e,t){if(t&&e)for(var r in e)if(e.hasOwnProperty(r)&&r.toLowerCase()===t.toLowerCase())return r;return null},decoded:function(e){return decodeURIComponent(e.replace(a," "))},converted:function(e){return 0===e.indexOf('"')&&(e=e.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\")),e},isEventType:function(e){for(var t in i.EventType)if(i.EventType.hasOwnProperty(t)&&i.EventType[t]===e)return!0;return!1},parseNumber:function(e){if(isNaN(e)||!isFinite(e))return 0;var t=parseFloat(e);return isNaN(t)?0:t},parseStringOrNumber:function(e){return l.isStringOrNumber(e)?e:null},generateHash:u,sanitizeAttributes:function(e){if(!e||!s(e))return null;var t={};for(var r in e)e.hasOwnProperty(r)&&l.isValidAttributeValue(e[r])?t[r]=e[r]:mParticle.Logger.warning("The corresponding attribute value of "+r+" must be a string, number, boolean, or null.");return t},returnConvertedBoolean:function(e){return"false"!==e&&"0"!==e&&Boolean(e)},invokeCallback:function(e,t,r,i,o){e||mParticle.Logger.warning("There is no callback provided");try{l.isFunction(e)&&e({httpCode:t,body:r,getUser:function(){return i||mParticle.Identity.getCurrentUser()},getPreviousUser:function(){if(o)return mParticle.Identity.getUser(o);var e=mParticle.Identity.getUsers(),t=e.shift(),r=i||mParticle.Identity.getCurrentUser();return t&&r&&t.getMPID()===r.getMPID()&&(t=e.shift()),t||null}})}catch(e){mParticle.Logger.error("There was an error with your callback: "+e)}},invokeAliasCallback:function(e,t,r){e||mParticle.Logger.warning("There is no callback provided");try{if(l.isFunction(e)){var i={httpCode:t};r&&(i.message=r),e(i)}}catch(e){mParticle.Logger.error("There was an error with your callback: "+e)}},hasFeatureFlag:function(e){if(mParticle.preInit.featureFlags)return mParticle.preInit.featureFlags[e]},isDelayedByIntegration:function(e,t,r){if(r-t>mParticle.Store.SDKConfig.integrationDelayTimeout)return!1;for(var i in e)if(!0===e[i])return!0;return!1},processQueuedEvents:function(e,t,r,i,o,n){if(e.length&&t&&r){var a=e;mParticle.Store.eventQueue=[],a.forEach(function(e){e.MPID=t,i(e,o,n)})}},createMainStorageName:function(e){return e?n.currentStorageName+"_"+e:n.currentStorageName},createProductStorageName:function(e){return e?n.currentStorageProductsName+"_"+e:n.currentStorageProductsName},Validators:l}},function(e,t){e.exports={sdkVersion:"2.9.5",sdkVendor:"mparticle",platform:"web",Messages:{ErrorMessages:{NoToken:"A token must be specified.",EventNameInvalidType:"Event name must be a valid string value.",EventDataInvalidType:"Event data must be a valid object hash.",LoggingDisabled:"Event logging is currently disabled.",CookieParseError:"Could not parse cookie",EventEmpty:"Event object is null or undefined, cancelling send",APIRequestEmpty:"APIRequest is null or undefined, cancelling send",NoEventType:"Event type must be specified.",TransactionIdRequired:"Transaction ID is required",TransactionRequired:"A transaction attributes object is required",PromotionIdRequired:"Promotion ID is required",BadAttribute:"Attribute value cannot be object or array",BadKey:"Key value cannot be object or array",BadLogPurchase:"Transaction attributes and a product are both required to log a purchase, https://docs.mparticle.com/?javascript#measuring-transactions"},InformationMessages:{CookieSearch:"Searching for cookie",CookieFound:"Cookie found, parsing values",CookieNotFound:"Cookies not found",CookieSet:"Setting cookie",CookieSync:"Performing cookie sync",SendBegin:"Starting to send event",SendIdentityBegin:"Starting to send event to identity server",SendWindowsPhone:"Sending event to Windows Phone container",SendIOS:"Calling iOS path: ",SendAndroid:"Calling Android JS interface method: ",SendHttp:"Sending event to mParticle HTTP service",SendAliasHttp:"Sending alias request to mParticle HTTP service",SendIdentityHttp:"Sending event to mParticle HTTP service",StartingNewSession:"Starting new Session",StartingLogEvent:"Starting to log event",StartingLogOptOut:"Starting to log user opt in/out",StartingEndSession:"Starting to end session",StartingInitialization:"Starting to initialize",StartingLogCommerceEvent:"Starting to log commerce event",StartingAliasRequest:"Starting to Alias MPIDs",LoadingConfig:"Loading configuration options",AbandonLogEvent:"Cannot log event, logging disabled or developer token not set",AbandonAliasUsers:"Cannot Alias Users, logging disabled or developer token not set",AbandonStartSession:"Cannot start session, logging disabled or developer token not set",AbandonEndSession:"Cannot end session, logging disabled or developer token not set",NoSessionToEnd:"Cannot end session, no active session found"},ValidationMessages:{ModifyIdentityRequestUserIdentitiesPresent:"identityRequests to modify require userIdentities to be present. Request not sent to server. Please fix and try again",IdentityRequesetInvalidKey:"There is an invalid key on your identityRequest object. It can only contain a `userIdentities` object and a `onUserAlias` function. Request not sent to server. Please fix and try again.",OnUserAliasType:"The onUserAlias value must be a function. The onUserAlias provided is of type",UserIdentities:"The userIdentities key must be an object with keys of identityTypes and values of strings. Request not sent to server. Please fix and try again.",UserIdentitiesInvalidKey:"There is an invalid identity key on your `userIdentities` object within the identityRequest. Request not sent to server. Please fix and try again.",UserIdentitiesInvalidValues:"All user identity values must be strings or null. Request not sent to server. Please fix and try again.",AliasMissingMpid:"Alias Request must contain both a destinationMpid and a sourceMpid",AliasNonUniqueMpid:"Alias Request's destinationMpid and sourceMpid must be unique",AliasMissingTime:"Alias Request must have both a startTime and an endTime",AliasStartBeforeEndTime:"Alias Request's endTime must be later than its startTime"}},NativeSdkPaths:{LogEvent:"logEvent",SetUserTag:"setUserTag",RemoveUserTag:"removeUserTag",SetUserAttribute:"setUserAttribute",RemoveUserAttribute:"removeUserAttribute",SetSessionAttribute:"setSessionAttribute",AddToCart:"addToCart",RemoveFromCart:"removeFromCart",ClearCart:"clearCart",LogOut:"logOut",SetUserAttributeList:"setUserAttributeList",RemoveAllUserAttributes:"removeAllUserAttributes",GetUserAttributesLists:"getUserAttributesLists",GetAllUserAttributes:"getAllUserAttributes",Identify:"identify",Logout:"logout",Login:"login",Modify:"modify",Alias:"aliasUsers"},StorageNames:{localStorageName:"mprtcl-api",localStorageNameV3:"mprtcl-v3",cookieName:"mprtcl-api",cookieNameV2:"mprtcl-v2",cookieNameV3:"mprtcl-v3",localStorageNameV4:"mprtcl-v4",localStorageProductsV4:"mprtcl-prodv4",cookieNameV4:"mprtcl-v4",currentStorageName:"mprtcl-v4",currentStorageProductsName:"mprtcl-prodv4"},DefaultConfig:{cookieDomain:null,cookieExpiration:365,logLevel:null,timeout:300,sessionTimeout:30,maxProducts:20,forwarderStatsTimeout:5e3,integrationDelayTimeout:5e3,maxCookieSize:3e3,aliasMaxWindow:90},DefaultUrls:{v1SecureServiceUrl:"jssdks.mparticle.com/v1/JS/",v2SecureServiceUrl:"jssdks.mparticle.com/v2/JS/",configUrl:"jssdkcdns.mparticle.com/JS/v2/",identityUrl:"identity.mparticle.com/v1/",aliasUrl:"jssdks.mparticle.com/v1/identity/"},Base64CookieKeys:{csm:1,sa:1,ss:1,ua:1,ui:1,csd:1,ia:1,con:1},HTTPCodes:{noHttpCoverage:-1,activeIdentityRequest:-2,activeSession:-3,validationIssue:-4,nativeIdentityRequest:-5,loggingDisabledOrMissingAPIKey:-6,tooManyRequests:429},Features:{Batching:"batching"},SDKv2NonMPIDCookieKeys:{gs:1,cu:1,l:1,globalSettings:1,currentUserMPID:1}}},function(e,t){var r={Unknown:0,Navigation:1,Location:2,Search:3,Transaction:4,UserContent:5,UserPreference:6,Social:7,Other:8,getName:function(e){switch(e){case r.Navigation:return"Navigation";case r.Location:return"Location";case r.Search:return"Search";case r.Transaction:return"Transaction";case r.UserContent:return"User Content";case r.UserPreference:return"User Preference";case r.Social:return"Social";case i.ProductAddToCart:return"Product Added to Cart";case i.ProductAddToWishlist:return"Product Added to Wishlist";case i.ProductCheckout:return"Product Checkout";case i.ProductCheckoutOption:return"Product Checkout Options";case i.ProductClick:return"Product Click";case i.ProductImpression:return"Product Impression";case i.ProductPurchase:return"Product Purchased";case i.ProductRefund:return"Product Refunded";case i.ProductRemoveFromCart:return"Product Removed From Cart";case i.ProductRemoveFromWishlist:return"Product Removed from Wishlist";case i.ProductViewDetail:return"Product View Details";case i.PromotionClick:return"Promotion Click";case i.PromotionView:return"Promotion View";default:return"Other"}}},i={ProductAddToCart:10,ProductRemoveFromCart:11,ProductCheckout:12,ProductCheckoutOption:13,ProductClick:14,ProductViewDetail:15,ProductPurchase:16,ProductRefund:17,PromotionView:18,PromotionClick:19,ProductAddToWishlist:20,ProductRemoveFromWishlist:21,ProductImpression:22},o={Other:0,CustomerId:1,Facebook:2,Twitter:3,Google:4,Microsoft:5,Yahoo:6,Email:7,FacebookCustomAudienceId:9,Other2:10,Other3:11,Other4:12,isValid:function(e){if("number"==typeof e)for(var t in o)if(o.hasOwnProperty(t)&&o[t]===e)return!0;return!1},getName:function(e){switch(e){case window.mParticle.IdentityType.CustomerId:return"Customer ID";case window.mParticle.IdentityType.Facebook:return"Facebook ID";case window.mParticle.IdentityType.Twitter:return"Twitter ID";case window.mParticle.IdentityType.Google:return"Google ID";case window.mParticle.IdentityType.Microsoft:return"Microsoft ID";case window.mParticle.IdentityType.Yahoo:return"Yahoo ID";case window.mParticle.IdentityType.Email:return"Email";case window.mParticle.IdentityType.FacebookCustomAudienceId:return"Facebook App User ID";default:return"Other ID"}},getIdentityType:function(e){switch(e){case"other":return o.Other;case"customerid":return o.CustomerId;case"facebook":return o.Facebook;case"twitter":return o.Twitter;case"google":return o.Google;case"microsoft":return o.Microsoft;case"yahoo":return o.Yahoo;case"email":return o.Email;case"facebookcustomaudienceid":return o.FacebookCustomAudienceId;case"other1":return o.Other1;case"other2":return o.Other2;case"other3":return o.Other3;case"other4":return o.Other4;default:return!1}},getIdentityName:function(e){switch(e){case o.Other:return"other";case o.CustomerId:return"customerid";case o.Facebook:return"facebook";case o.Twitter:return"twitter";case o.Google:return"google";case o.Microsoft:return"microsoft";case o.Yahoo:return"yahoo";case o.Email:return"email";case o.FacebookCustomAudienceId:return"facebookcustomaudienceid";case o.Other1:return"other1";case o.Other2:return"other2";case o.Other3:return"other3";case o.Other4:return"other4"}}},n={Unknown:0,AddToCart:1,RemoveFromCart:2,Checkout:3,CheckoutOption:4,Click:5,ViewDetail:6,Purchase:7,Refund:8,AddToWishlist:9,RemoveFromWishlist:10,getName:function(e){switch(e){case n.AddToCart:return"Add to Cart";case n.RemoveFromCart:return"Remove from Cart";case n.Checkout:return"Checkout";case n.CheckoutOption:return"Checkout Option";case n.Click:return"Click";case n.ViewDetail:return"View Detail";case n.Purchase:return"Purchase";case n.Refund:return"Refund";case n.AddToWishlist:return"Add to Wishlist";case n.RemoveFromWishlist:return"Remove from Wishlist";default:return"Unknown"}},getExpansionName:function(e){switch(e){case n.AddToCart:return"add_to_cart";case n.RemoveFromCart:return"remove_from_cart";case n.Checkout:return"checkout";case n.CheckoutOption:return"checkout_option";case n.Click:return"click";case n.ViewDetail:return"view_detail";case n.Purchase:return"purchase";case n.Refund:return"refund";case n.AddToWishlist:return"add_to_wishlist";case n.RemoveFromWishlist:return"remove_from_wishlist";default:return"unknown"}}},a={Unknown:0,PromotionView:1,PromotionClick:2,getName:function(e){switch(e){case a.PromotionView:return"view";case a.PromotionClick:return"click";default:return"unknown"}},getExpansionName:function(e){switch(e){case a.PromotionView:return"view";case a.PromotionClick:return"click";default:return"unknown"}}};e.exports={MessageType:{SessionStart:1,SessionEnd:2,PageView:3,PageEvent:4,CrashReport:5,OptOut:6,AppStateTransition:10,Profile:14,Commerce:16},EventType:r,CommerceEventType:i,IdentityType:o,ProfileMessageType:{Logout:3},ApplicationTransitionType:{AppInit:1},ProductActionType:n,PromotionActionType:a}},function(e,t,r){var i=r(0),o=r(1),n=r(8).Base64,a=o.Messages,s=o.Base64CookieKeys,c=o.SDKv2NonMPIDCookieKeys,u=o.StorageNames,l=r(13);function d(){return!mParticle.Store.SDKConfig.useCookieStorage&&mParticle.Store.isLocalStorageAvailable}function g(){var e,t,r=localStorage.getItem(mParticle.Store.prodStorageName);r&&(e=n.decode(r));try{t=JSON.parse(e)}catch(e){t={}}return t}function m(){if(!mParticle.Store.isLocalStorageAvailable)return null;var e,t=mParticle.Store.storageName,r=h(window.localStorage.getItem(t)),i={};if(r)for(e in r=JSON.parse(r))r.hasOwnProperty(e)&&(i[e]=r[e]);return Object.keys(i).length?i:null}function f(e){localStorage.removeItem(e)}function v(e){var t,r,i,o=new Date;r=""===(i=k())?"":";domain="+i,o.setTime(o.getTime()-864e5),t="; expires="+o.toUTCString(),document.cookie=e+"="+t+"; path=/"+r}function p(){var e,t,r,o,n,s=window.document.cookie.split("; "),c=mParticle.Store.storageName,u=c?void 0:{};for(mParticle.Logger.verbose(a.InformationMessages.CookieSearch),e=0,t=s.length;e<t;e++){if(r=s[e].split("="),o=i.decoded(r.shift()),n=i.decoded(r.join("=")),c&&c===o){u=i.converted(n);break}c||(u[o]=i.converted(n))}return u?(mParticle.Logger.verbose(a.InformationMessages.CookieFound),JSON.parse(h(u))):null}function P(e,t,r,i){var o,n=e.gs.csm?e.gs.csm:[];if(n.length){var a={};for(var s in e)e.hasOwnProperty(s)&&(c[s]||s===e.cu||(a[s]=1));if(Object.keys(a).length)for(var u in a)(o=S(e,t,r)).length>i&&a.hasOwnProperty(u)&&-1===n.indexOf(u)&&delete e[u];for(var l=0;l<n.length&&(o=S(e,t,r)).length>i;l++){var d=n[l];e[d]?(mParticle.Logger.verbose("Size of new encoded cookie is larger than maxCookieSize setting of "+i+". Removing from cookie the earliest logged in MPID containing: "+JSON.stringify(e[d],0,2)),delete e[d]):mParticle.Logger.error("Unable to save MPID data to cookies because the resulting encoded cookie is larger than the maxCookieSize setting of "+i+". We recommend using a maxCookieSize of 1500.")}}else for(var g in e)e.hasOwnProperty(g)&&(o=S(e,t,r)).length>i&&(c[g]||g===e.cu||delete e[g]);return o}function S(e,t,r){return y(JSON.stringify(e))+";expires="+t+";path=/"+r}function y(e){for(var t in(e=JSON.parse(e)).gs)e.gs.hasOwnProperty(t)&&(s[t]?e.gs[t]?Array.isArray(e.gs[t])&&e.gs[t].length?e.gs[t]=n.encode(JSON.stringify(e.gs[t])):i.isObject(e.gs[t])&&Object.keys(e.gs[t]).length?e.gs[t]=n.encode(JSON.stringify(e.gs[t])):delete e.gs[t]:delete e.gs[t]:"ie"===t?e.gs[t]=e.gs[t]?1:0:e.gs[t]||delete e.gs[t]);for(var r in e)if(e.hasOwnProperty(r)&&!c[r])for(t in e[r])e[r].hasOwnProperty(t)&&s[t]&&(i.isObject(e[r][t])&&Object.keys(e[r][t]).length?e[r][t]=n.encode(JSON.stringify(e[r][t])):delete e[r][t]);return I(JSON.stringify(e))}function h(e){try{if(e){if(e=JSON.parse(T(e)),i.isObject(e)&&Object.keys(e).length){for(var t in e.gs)e.gs.hasOwnProperty(t)&&(s[t]?e.gs[t]=JSON.parse(n.decode(e.gs[t])):"ie"===t&&(e.gs[t]=Boolean(e.gs[t])));for(var r in e)if(e.hasOwnProperty(r))if(c[r])"l"===r&&(e[r]=Boolean(e[r]));else for(t in e[r])e[r].hasOwnProperty(t)&&s[t]&&e[r][t].length&&(e[r][t]=JSON.parse(n.decode(e[r][t])))}return JSON.stringify(e)}}catch(e){mParticle.Logger.error("Problem with decoding cookie",e)}}function b(e){return e.replace(/,/g,"|")}function C(e){return e.replace(/\|/g,",")}function A(e){return e.replace(/\'/g,'"')}function w(e){return e.replace(/\"/g,"'")}function I(e){return b(w(e))}function T(e){return C(A(e))}function k(){if(mParticle.Store.SDKConfig.cookieDomain)return mParticle.Store.SDKConfig.cookieDomain;var e=function(e,t){var r,i,o="mptest=cookie",n=t.split(".");for(r=n.length-1;r>=0;r--)if(i=n.slice(r).join("."),e.cookie=o+";domain=."+i+";",e.cookie.indexOf(o)>-1)return e.cookie=o.split("=")[0]+"=;domain=."+i+";expires=Thu, 01 Jan 1970 00:00:01 GMT;",i;return""}(document,location.hostname);return""===e?"":"."+e}function E(e){var t,r=y(JSON.stringify(e)),i=new Date,o=mParticle.Store.storageName,n=new Date(i.getTime()+24*mParticle.Store.SDKConfig.cookieExpiration*60*60*1e3).toGMTString(),a=k();if(t=""===a?"":";domain="+a,mParticle.Store.SDKConfig.useCookieStorage){var s=P(e,n,t,mParticle.Store.SDKConfig.maxCookieSize);window.document.cookie=encodeURIComponent(o)+"="+s}else mParticle.Store.isLocalStorageAvailable&&localStorage.setItem(mParticle.Store.storageName,r)}function D(){return mParticle.Store.SDKConfig.useCookieStorage?p():m()}e.exports={useLocalStorage:d,initializeStorage:function(){try{var e,t,r=this.getLocalStorage(),o=this.getCookie();r||o?mParticle.Store.isFirstRun=!1:(mParticle.Store.isFirstRun=!0,mParticle.Store.mpid=0),mParticle.Store.isLocalStorageAvailable||(mParticle.Store.SDKConfig.useCookieStorage=!0),mParticle.Store.isLocalStorageAvailable?(e=window.localStorage,mParticle.Store.SDKConfig.useCookieStorage?(r?(t=o?i.extend(!1,r,o):r,e.removeItem(mParticle.Store.storageName)):o&&(t=o),this.storeDataInMemory(t)):o?(t=r?i.extend(!1,r,o):o,this.storeDataInMemory(t),this.expireCookies(mParticle.Store.storageName)):this.storeDataInMemory(r)):this.storeDataInMemory(o);try{if(mParticle.Store.isLocalStorageAvailable){var s=localStorage.getItem(mParticle.Store.prodStorageName);if(s)var u=JSON.parse(n.decode(s));mParticle.Store.mpid&&function(e,t){if(e)try{mParticle.Store.cartProducts=e[t]&&e[t].cp?e[t].cp:[]}catch(e){mParticle.Logger.error(a.ErrorMessages.CookieParseError)}}(u,mParticle.Store.mpid)}}catch(e){mParticle.Store.isLocalStorageAvailable&&localStorage.removeItem(mParticle.Store.prodStorageName),mParticle.Store.cartProducts=[],mParticle.Logger.error("Error loading products in initialization: "+e)}for(var l in t)t.hasOwnProperty(l)&&(c[l]||(mParticle.Store.nonCurrentUserMPIDs[l]=t[l]));this.update()}catch(e){d()&&mParticle.Store.isLocalStorageAvailable?localStorage.removeItem(mParticle.Store.storageName):v(mParticle.Store.storageName),mParticle.Logger.error("Error initializing storage: "+e)}},update:function(){mParticle.Store.webviewBridgeEnabled||(mParticle.Store.SDKConfig.useCookieStorage&&this.setCookie(),this.setLocalStorage())},determineLocalStorageAvailability:function(e){var t;mParticle._forceNoLocalStorage&&(e=void 0);try{return e.setItem("mparticle","test"),t="test"===e.getItem("mparticle"),e.removeItem("mparticle"),t&&e}catch(e){return!1}},getUserProductsFromLS:function(e){if(!mParticle.Store.isLocalStorageAvailable)return[];var t,r,i=localStorage.getItem(mParticle.Store.prodStorageName);if(i&&(t=n.decode(i)),!e)return[];try{return t&&(r=JSON.parse(t)),t&&r[e]&&r[e].cp&&Array.isArray(r[e].cp)?r[e].cp:[]}catch(e){return[]}},getAllUserProductsFromLS:g,setLocalStorage:function(){if(mParticle.Store.isLocalStorageAvailable){var e=mParticle.Store.storageName,t=g(),r=this.getLocalStorage()||{},o=mParticle.Identity.getCurrentUser(),a=o?o.getMPID():null,s={cp:t[a]?t[a].cp:[]};if(a){(t=t||{})[a]=s;try{window.localStorage.setItem(encodeURIComponent(mParticle.Store.prodStorageName),n.encode(JSON.stringify(t)))}catch(e){mParticle.Logger.error("Error with setting products on localStorage.")}}if(!mParticle.Store.SDKConfig.useCookieStorage){r.gs=r.gs||{},r.l=mParticle.Store.isLoggedIn?1:0,mParticle.Store.sessionId&&(r.gs.csm=mParticle.Store.currentSessionMPIDs),r.gs.ie=mParticle.Store.isEnabled,a&&(r.cu=a),Object.keys(mParticle.Store.nonCurrentUserMPIDs).length&&(r=i.extend({},r,mParticle.Store.nonCurrentUserMPIDs),mParticle.Store.nonCurrentUserMPIDs={}),r=this.setGlobalStorageAttributes(r);try{window.localStorage.setItem(encodeURIComponent(e),y(JSON.stringify(r)))}catch(e){mParticle.Logger.error("Error with setting localStorage item.")}}}},setGlobalStorageAttributes:function(e){var t=mParticle.Store;return e.gs.sid=t.sessionId,e.gs.ie=t.isEnabled,e.gs.sa=t.sessionAttributes,e.gs.ss=t.serverSettings,e.gs.dt=t.devToken,e.gs.les=t.dateLastEventSent?t.dateLastEventSent.getTime():null,e.gs.av=t.SDKConfig.appVersion,e.gs.cgid=t.clientId,e.gs.das=t.deviceId,e.gs.c=t.context,e.gs.ssd=t.sessionStartDate?t.sessionStartDate.getTime():null,e.gs.ia=t.integrationAttributes,e},getLocalStorage:m,storeDataInMemory:function(e,t){try{e?(mParticle.Store.mpid=t||e.cu||0,e.gs=e.gs||{},mParticle.Store.sessionId=e.gs.sid||mParticle.Store.sessionId,mParticle.Store.isEnabled=void 0!==e.gs.ie?e.gs.ie:mParticle.Store.isEnabled,mParticle.Store.sessionAttributes=e.gs.sa||mParticle.Store.sessionAttributes,mParticle.Store.serverSettings=e.gs.ss||mParticle.Store.serverSettings,mParticle.Store.devToken=mParticle.Store.devToken||e.gs.dt,mParticle.Store.SDKConfig.appVersion=mParticle.Store.SDKConfig.appVersion||e.gs.av,mParticle.Store.clientId=e.gs.cgid||mParticle.Store.clientId||i.generateUniqueId(),mParticle.Store.deviceId=e.gs.das||mParticle.Store.deviceId||i.generateUniqueId(),mParticle.Store.integrationAttributes=e.gs.ia||{},mParticle.Store.context=e.gs.c||mParticle.Store.context,mParticle.Store.currentSessionMPIDs=e.gs.csm||mParticle.Store.currentSessionMPIDs,mParticle.Store.isLoggedIn=!0===e.l,e.gs.les&&(mParticle.Store.dateLastEventSent=new Date(e.gs.les)),e.gs.ssd?mParticle.Store.sessionStartDate=new Date(e.gs.ssd):mParticle.Store.sessionStartDate=new Date,e=t?e[t]:e[e.cu]):(mParticle.Logger.verbose(a.InformationMessages.CookieNotFound),mParticle.Store.clientId=mParticle.Store.clientId||i.generateUniqueId(),mParticle.Store.deviceId=mParticle.Store.deviceId||i.generateUniqueId())}catch(e){mParticle.Logger.error(a.ErrorMessages.CookieParseError)}},retrieveDeviceId:function(){return mParticle.Store.deviceId?mParticle.Store.deviceId:this.parseDeviceId(mParticle.Store.serverSettings)},parseDeviceId:function(e){try{var t,r={};return e&&e.uid&&e.uid.Value&&(e.uid.Value.split("&").forEach(function(e){t=e.split("="),r[t[0]]=t[1]}),r.g)?r.g:i.generateUniqueId()}catch(e){return i.generateUniqueId()}},expireCookies:v,getCookie:p,setCookie:function(){var e,t=mParticle.Identity.getCurrentUser();t&&(e=t.getMPID());var r,o,n,s=new Date,c=mParticle.Store.storageName,u=this.getCookie()||{},l=new Date(s.getTime()+24*mParticle.Store.SDKConfig.cookieExpiration*60*60*1e3).toGMTString();o=""===(r=k())?"":";domain="+r,u.gs=u.gs||{},mParticle.Store.sessionId&&(u.gs.csm=mParticle.Store.currentSessionMPIDs),e&&(u.cu=e),u.l=mParticle.Store.isLoggedIn?1:0,u=this.setGlobalStorageAttributes(u),Object.keys(mParticle.Store.nonCurrentUserMPIDs).length&&(u=i.extend({},u,mParticle.Store.nonCurrentUserMPIDs),mParticle.Store.nonCurrentUserMPIDs={}),n=P(u,l,o,mParticle.Store.SDKConfig.maxCookieSize),mParticle.Logger.verbose(a.InformationMessages.CookieSet),window.document.cookie=encodeURIComponent(c)+"="+n},reduceAndEncodeCookies:P,findPrevCookiesBasedOnUI:function(e){var t,r=this.getCookie()||this.getLocalStorage();if(e)for(var i in e.userIdentities)if(r&&Object.keys(r).length)for(var o in r)if(r[o].mpid){var n=r[o].ui;for(var a in n)if(i===a&&e.userIdentities[i]===n[a]){t=o;break}}t&&this.storeDataInMemory(r,t)},replaceCommasWithPipes:b,replacePipesWithCommas:C,replaceApostrophesWithQuotes:A,replaceQuotesWithApostrophes:w,createCookieString:I,revertCookieString:T,encodeCookies:y,decodeCookies:h,getCookieDomain:k,decodeProducts:function(){return JSON.parse(n.decode(localStorage.getItem(mParticle.Store.prodStorageName)))},getUserIdentities:function(e){var t=D();return t&&t[e]&&t[e].ui?t[e].ui:{}},getAllUserAttributes:function(e){var t=D();return t&&t[e]&&t[e].ua?t[e].ua:{}},getCartProducts:function(e){var t=JSON.parse(n.decode(localStorage.getItem(mParticle.Store.prodStorageName)));return t&&t[e]&&t[e].cp?t[e].cp:[]},setCartProducts:function(e){if(mParticle.Store.isLocalStorageAvailable)try{window.localStorage.setItem(encodeURIComponent(mParticle.Store.prodStorageName),n.encode(JSON.stringify(e)))}catch(e){mParticle.Logger.error("Error with setting products on localStorage.")}},saveCookies:E,saveUserIdentitiesToCookies:function(e,t){if(t){var r=D();r&&(r[e]?r[e].ui=t:r[e]={ui:t},E(r))}},saveUserAttributesToCookies:function(e,t){var r=D();t&&(r&&(r[e]?r[e].ui=t:r[e]={ui:t}),E(r))},saveUserCookieSyncDatesToCookies:function(e,t){if(t){var r=D();r&&(r[e]?r[e].csd=t:r[e]={csd:t}),E(r)}},saveUserConsentStateToCookies:function(e,t){if(t||null===t){var r=D();r&&(r[e]?r[e].con=l.Serialization.toMinifiedJsonObject(t):r[e]={con:l.Serialization.toMinifiedJsonObject(t)},E(r))}},getPersistence:D,getDeviceId:function(){return mParticle.Store.deviceId},resetPersistence:function(){f(u.localStorageName),f(u.localStorageNameV3),f(u.localStorageNameV4),f(mParticle.Store.prodStorageName),f(u.localStorageProductsV4),v(u.cookieName),v(u.cookieNameV2),v(u.cookieNameV3),v(u.cookieNameV4),mParticle._isTestEnv&&(f(i.createMainStorageName("abcdef")),v(i.createMainStorageName("abcdef")),f(i.createProductStorageName("abcdef")))},getConsentState:function(e){var t=D();return t&&t[e]&&t[e].con?l.Serialization.fromMinifiedJsonObject(t[e].con):null},forwardingStatsBatches:{uploadsTable:{},forwardingStatsEventQueue:[]},getFirstSeenTime:function(e){if(!e)return null;var t=D();return t&&t[e]&&t[e].fst?t[e].fst:null},getLastSeenTime:function(e){if(!e)return null;if(e===mParticle.Identity.getCurrentUser().getMPID())return(new Date).getTime();var t=D();return t&&t[e]&&t[e].lst?t[e].lst:null},setFirstSeenTime:function(e,t){if(e){t||(t=(new Date).getTime());var r=D();r&&(r[e]||(r[e]={}),r[e].fst||(r[e].fst=t,E(r)))}},setLastSeenTime:function(e,t){if(e){t||(t=(new Date).getTime());var r=D();r&&r[e]&&(r[e].lst=t,E(r))}}}},function(e,t,r){var i=r(0),o=r(1),n=r(9),a=o.HTTPCodes,s=r(7),c=r(2),u=o.Messages;e.exports={sendEventToServer:function e(t,r,a){var l,d=mParticle.Identity.getCurrentUser();if(d&&(l=d.getMPID()),mParticle.Store.webviewBridgeEnabled)n.sendToNative(o.NativeSdkPaths.LogEvent,JSON.stringify(t));else{var g;mParticle.Logger.verbose(u.InformationMessages.SendBegin);var m=[];if(i.isObject(t.UserIdentities)&&Object.keys(t.UserIdentities).length){for(var f in t.UserIdentities){var v={};v.Identity=t.UserIdentities[f],v.Type=i.parseNumber(f),m.push(v)}t.UserIdentities=m}else t.UserIdentities=[];if(mParticle.Store.requireDelay=i.isDelayedByIntegration(mParticle.preInit.integrationDelays,mParticle.Store.integrationDelayTimeoutStart,Date.now()),!l||mParticle.Store.requireDelay)mParticle.Logger.verbose("Event was added to eventQueue. eventQueue will be processed once a valid MPID is returned or there is no more integration imposed delay."),mParticle.Store.eventQueue.push(t);else{if(i.processQueuedEvents(mParticle.Store.eventQueue,l,!mParticle.Store.requiredDelay,e,r,a),!t)return void mParticle.Logger.error(u.ErrorMessages.EventEmpty);if(mParticle.Logger.verbose(u.InformationMessages.SendHttp),g=i.createXHR(function(){4===g.readyState&&(mParticle.Logger.verbose("Received "+g.statusText+" from server"),a(g.responseText))}))try{g.open("post",i.createServiceUrl(mParticle.Store.SDKConfig.v2SecureServiceUrl,mParticle.Store.devToken)+"/Events"),g.send(JSON.stringify(s.convertEventToDTO(t,mParticle.Store.isFirstRun,mParticle.Store.currencyCode,mParticle.Store.integrationAttributes))),t.EventName!==c.MessageType.AppStateTransition&&r(t)}catch(e){mParticle.Logger.error("Error sending event to mParticle servers. "+e)}}}},sendIdentityRequest:function(e,t,r,o,n,s){var c,l;if(mParticle.Logger.verbose(u.InformationMessages.SendIdentityBegin),e){if(mParticle.Logger.verbose(u.InformationMessages.SendIdentityHttp),c=i.createXHR(function(){4===c.readyState&&(mParticle.Logger.verbose("Received "+c.statusText+" from server"),n(c,l,r,o,t))}))try{mParticle.Store.identityCallInFlight?i.invokeCallback(r,a.activeIdentityRequest,"There is currently an Identity request processing. Please wait for this to return before requesting again"):(l=s||null,"modify"===t?c.open("post",i.createServiceUrl(mParticle.Store.SDKConfig.identityUrl)+s+"/"+t):c.open("post",i.createServiceUrl(mParticle.Store.SDKConfig.identityUrl)+t),c.setRequestHeader("Content-Type","application/json"),c.setRequestHeader("x-mp-key",mParticle.Store.devToken),mParticle.Store.identityCallInFlight=!0,c.send(JSON.stringify(e)))}catch(e){mParticle.Store.identityCallInFlight=!1,i.invokeCallback(r,a.noHttpCoverage,e),mParticle.Logger.error("Error sending identity request to servers with status code "+c.status+" - "+e)}}else mParticle.Logger.error(u.ErrorMessages.APIRequestEmpty)},sendBatchForwardingStatsToServer:function(e,t){var r,o;try{r=i.createServiceUrl(mParticle.Store.SDKConfig.v2SecureServiceUrl,mParticle.Store.devToken),o={uuid:i.generateUniqueId(),data:e},t&&(t.open("post",r+"/Forwarding"),t.send(JSON.stringify(o)))}catch(e){mParticle.Logger.error("Error sending forwarding stats to mParticle servers.")}},sendSingleForwardingStatsToServer:function(e){var t,r;try{var o=i.createXHR(function(){4===o.readyState&&202===o.status&&mParticle.Logger.verbose("Successfully sent  "+o.statusText+" from server")});t=i.createServiceUrl(mParticle.Store.SDKConfig.v1SecureServiceUrl,mParticle.Store.devToken),r=e,o&&(o.open("post",t+"/Forwarding"),o.send(JSON.stringify(r)))}catch(e){mParticle.Logger.error("Error sending forwarding stats to mParticle servers.")}},sendAliasRequest:function(e,t){var r;if(mParticle.Logger.verbose(u.InformationMessages.SendAliasHttp),r=i.createXHR(function(){if(4===r.readyState){if(mParticle.Logger.verbose("Received "+r.statusText+" from server"),200!==r.status&&202!==r.status&&r.responseText){var e=JSON.parse(r.responseText);if(e.hasOwnProperty("message")){var o=e.message;return void i.invokeAliasCallback(t,r.status,o)}}i.invokeAliasCallback(t,r.status)}}))try{r.open("post",i.createServiceUrl(mParticle.Store.SDKConfig.aliasUrl,mParticle.Store.devToken)+"/Alias"),r.send(JSON.stringify(e))}catch(e){i.invokeAliasCallback(t,a.noHttpCoverage,e),mParticle.Logger.error("Error sending alias request to mParticle servers. "+e)}},getSDKConfiguration:function(e,t,r){var n;try{var a=i.createXHR(function(){4===a.readyState&&(200===a.status?(t=i.extend({},t,JSON.parse(a.responseText)),r(e,t),mParticle.Logger.verbose("Successfully received configuration from server")):(r(e,t),mParticle.Logger.verbose("Issue with receiving configuration from server, received HTTP Code of "+a.status)))});n="https://"+o.DefaultUrls.configUrl+e+"/config?env=",t.isDevelopmentMode?n+="1":n+="0",a&&(a.open("get",n),a.send(null))}catch(i){r(e,t),mParticle.Logger.error("Error getting forwarder configuration from mParticle servers.")}}}},function(e,t,r){var i=r(0),o=r(1),n=r(7),a=r(6),s=r(3),c=r(2),u=o.Messages,l=r(9),d=i.Validators,g=r(4).sendIdentityRequest,m=r(12),f=r(4).sendEventToServer,v=o.HTTPCodes,p=r(10),P=r(6).sendEventToForwarders,S=r(4).sendAliasRequest,y={checkIdentitySwap:function(e,t,r){if(e&&t&&e!==t){var i=s.useLocalStorage()?s.getLocalStorage():s.getCookie();i.cu=t,i.gs.csm=r,s.saveCookies(i)}}},h={createKnownIdentities:function(e,t){var r={};if(e&&e.userIdentities&&i.isObject(e.userIdentities))for(var o in e.userIdentities)r[o]=e.userIdentities[o];return r.device_application_stamp=t,r},preProcessIdentityRequest:function(e,t,r){mParticle.Logger.verbose(u.InformationMessages.StartingLogEvent+": "+r);var i=d.validateIdentities(e,r);if(!i.valid)return mParticle.Logger.error("ERROR: "+i.error),{valid:!1,error:i.error};if(t&&!d.isFunction(t)){var o="The optional callback must be a function. You tried entering a(n) "+typeof t;return mParticle.Logger.error(o),{valid:!1,error:o}}return{valid:!0}},createIdentityRequest:function(e,t,r,o,n,a,s){return{client_sdk:{platform:t,sdk_vendor:r,sdk_version:o},context:a,environment:mParticle.Store.SDKConfig.isDevelopmentMode?"development":"production",request_id:i.generateUniqueId(),request_timestamp_ms:(new Date).getTime(),previous_mpid:s||null,known_identities:this.createKnownIdentities(e,n)}},createModifyIdentityRequest:function(e,t,r,o,n,a){return{client_sdk:{platform:r,sdk_vendor:o,sdk_version:n},context:a,environment:mParticle.Store.SDKConfig.isDevelopmentMode?"development":"production",request_id:i.generateUniqueId(),request_timestamp_ms:(new Date).getTime(),identity_changes:this.createIdentityChanges(e,t)}},createIdentityChanges:function(e,t){var r,o=[];if(t&&i.isObject(t)&&e&&i.isObject(e))for(r in t)o.push({old_value:e[c.IdentityType.getIdentityType(r)]||null,new_value:t[r],identity_type:r});return o},modifyUserIdentities:function(e,t){var r={};for(var i in t)r[c.IdentityType.getIdentityType(i)]=t[i];for(i in e)r[i]||(r[i]=e[i]);return r},createAliasNetworkRequest:function(e){return{request_id:i.generateUniqueId(),request_type:"alias",environment:mParticle.preInit.isDevelopmentMode?"development":"production",api_key:mParticle.Store.devToken,data:{destination_mpid:e.destinationMpid,source_mpid:e.sourceMpid,start_unixtime_ms:e.startTime,end_unixtime_ms:e.endTime,device_application_stamp:mParticle.Store.deviceId}}},convertAliasToNative:function(e){return{DestinationMpid:e.destinationMpid,SourceMpid:e.sourceMpid,StartUnixtimeMs:e.startTime,EndUnixtimeMs:e.endTime}},convertToNative:function(e){var t=[];if(e&&e.userIdentities){for(var r in e.userIdentities)e.userIdentities.hasOwnProperty(r)&&t.push({Type:c.IdentityType.getIdentityType(r),Identity:e.userIdentities[r]});return{UserIdentities:t}}}},b={HTTPCodes:v,identify:function(e,t){var r,n=mParticle.Identity.getCurrentUser(),a=h.preProcessIdentityRequest(e,t,"identify");if(n&&(r=n.getMPID()),a.valid){var s=h.createIdentityRequest(e,o.platform,o.sdkVendor,o.sdkVersion,mParticle.Store.deviceId,mParticle.Store.context,r);i.canLog()?mParticle.Store.webviewBridgeEnabled?(l.sendToNative(o.NativeSdkPaths.Identify,JSON.stringify(h.convertToNative(e))),i.invokeCallback(t,v.nativeIdentityRequest,"Identify request sent to native sdk")):g(s,"identify",t,e,w,r):(i.invokeCallback(t,v.loggingDisabledOrMissingAPIKey,u.InformationMessages.AbandonLogEvent),mParticle.Logger.verbose(u.InformationMessages.AbandonLogEvent))}else i.invokeCallback(t,v.validationIssue,a.error),mParticle.Logger.verbose(a)},logout:function(e,t){var r,a=mParticle.Identity.getCurrentUser(),s=h.preProcessIdentityRequest(e,t,"logout");if(a&&(r=a.getMPID()),s.valid){var d,m=h.createIdentityRequest(e,o.platform,o.sdkVendor,o.sdkVersion,mParticle.Store.deviceId,mParticle.Store.context,r);i.canLog()?mParticle.Store.webviewBridgeEnabled?(l.sendToNative(o.NativeSdkPaths.Logout,JSON.stringify(h.convertToNative(e))),i.invokeCallback(t,v.nativeIdentityRequest,"Logout request sent to native sdk")):(g(m,"logout",t,e,w,r),(d=n.createEventObject(c.MessageType.Profile)).ProfileMessageType=c.ProfileMessageType.Logout,mParticle.Store.activeForwarders.length&&mParticle.Store.activeForwarders.forEach(function(e){e.logOut&&e.logOut(d)})):(i.invokeCallback(t,v.loggingDisabledOrMissingAPIKey,u.InformationMessages.AbandonLogEvent),mParticle.Logger.verbose(u.InformationMessages.AbandonLogEvent))}else i.invokeCallback(t,v.validationIssue,s.error),mParticle.Logger.verbose(s)},login:function(e,t){var r,n=mParticle.Identity.getCurrentUser(),a=h.preProcessIdentityRequest(e,t,"login");if(n&&(r=n.getMPID()),a.valid){var s=h.createIdentityRequest(e,o.platform,o.sdkVendor,o.sdkVersion,mParticle.Store.deviceId,mParticle.Store.context,r);i.canLog()?mParticle.Store.webviewBridgeEnabled?(l.sendToNative(o.NativeSdkPaths.Login,JSON.stringify(h.convertToNative(e))),i.invokeCallback(t,v.nativeIdentityRequest,"Login request sent to native sdk")):g(s,"login",t,e,w,r):(i.invokeCallback(t,v.loggingDisabledOrMissingAPIKey,u.InformationMessages.AbandonLogEvent),mParticle.Logger.verbose(u.InformationMessages.AbandonLogEvent))}else i.invokeCallback(t,v.validationIssue,a.error),mParticle.Logger.verbose(a)},modify:function(e,t){var r,n=mParticle.Identity.getCurrentUser(),a=h.preProcessIdentityRequest(e,t,"modify");n&&(r=n.getMPID());var s=e&&e.userIdentities?e.userIdentities:{};if(a.valid){var c=h.createModifyIdentityRequest(n?n.getUserIdentities().userIdentities:{},s,o.platform,o.sdkVendor,o.sdkVersion,mParticle.Store.context);i.canLog()?mParticle.Store.webviewBridgeEnabled?(l.sendToNative(o.NativeSdkPaths.Modify,JSON.stringify(h.convertToNative(e))),i.invokeCallback(t,v.nativeIdentityRequest,"Modify request sent to native sdk")):g(c,"modify",t,e,w,r):(i.invokeCallback(t,v.loggingDisabledOrMissingAPIKey,u.InformationMessages.AbandonLogEvent),mParticle.Logger.verbose(u.InformationMessages.AbandonLogEvent))}else i.invokeCallback(t,v.validationIssue,a.error),mParticle.Logger.verbose(a)},getCurrentUser:function(){var e=mParticle.Store.mpid;return e?C(e=mParticle.Store.mpid.slice(),mParticle.Store.isLoggedIn):mParticle.Store.webviewBridgeEnabled?C():null},getUser:function(e){var t=s.getPersistence();return t&&t[e]&&!o.SDKv2NonMPIDCookieKeys.hasOwnProperty(e)?C(e):null},getUsers:function(){var e=s.getPersistence(),t=[];if(e)for(var r in e)o.SDKv2NonMPIDCookieKeys.hasOwnProperty(r)||t.push(C(r));return t.sort(function(e,t){return(e.getLastSeenTime()||0)>(t.getLastSeenTime()||0)?-1:1}),t},aliasUsers:function(e,t){var r;if(e.destinationMpid&&e.sourceMpid||(r=u.ValidationMessages.AliasMissingMpid),e.destinationMpid===e.sourceMpid&&(r=u.ValidationMessages.AliasNonUniqueMpid),e.startTime&&e.endTime||(r=u.ValidationMessages.AliasMissingTime),e.startTime>e.endTime&&(r=u.ValidationMessages.AliasStartBeforeEndTime),r)return mParticle.Logger.warning(r),void i.invokeAliasCallback(t,v.validationIssue,r);if(i.canLog())if(mParticle.Store.webviewBridgeEnabled)l.sendToNative(o.NativeSdkPaths.Alias,JSON.stringify(h.convertAliasToNative(e))),i.invokeAliasCallback(t,v.nativeIdentityRequest,"Alias request sent to native sdk");else{mParticle.Logger.verbose(u.InformationMessages.StartingAliasRequest+": "+e.sourceMpid+" -> "+e.destinationMpid);var n=h.createAliasNetworkRequest(e);S(n,t)}else i.invokeAliasCallback(t,v.loggingDisabledOrMissingAPIKey,u.InformationMessages.AbandonAliasUsers),mParticle.Logger.verbose(u.InformationMessages.AbandonAliasUsers)},createAliasRequest:function(e,t){try{if(!t||!e)return mParticle.Logger.error("'destinationUser' and 'sourceUser' must both be present"),null;var r=e.getFirstSeenTime();r||mParticle.Identity.getUsers().forEach(function(e){e.getFirstSeenTime()&&(!r||e.getFirstSeenTime()<r)&&(r=e.getFirstSeenTime())});var i=(new Date).getTime()-24*mParticle.Store.SDKConfig.aliasMaxWindow*60*60*1e3,o=e.getLastSeenTime()||(new Date).getTime();return r<i&&o<(r=i)&&mParticle.Logger.warning("Source User has not been seen in the last "+mParticle.Store.SDKConfig.maxAliasWindow+" days, Alias Request will likely fail"),{destinationMpid:t.getMPID(),sourceMpid:e.getMPID(),startTime:r,endTime:o}}catch(e){return mParticle.Logger.error("There was a problem with creating an alias request: "+e),null}}};function C(e,t){return{getUserIdentities:function(){var t={},r=s.getUserIdentities(e);for(var o in r)r.hasOwnProperty(o)&&(t[c.IdentityType.getIdentityName(i.parseNumber(o))]=r[o]);return{userIdentities:t}},getMPID:function(){return e},setUserTag:function(e){d.isValidKeyValue(e)?this.setUserAttribute(e,null):mParticle.Logger.error(u.ErrorMessages.BadKey)},removeUserTag:function(e){d.isValidKeyValue(e)?this.removeUserAttribute(e):mParticle.Logger.error(u.ErrorMessages.BadKey)},setUserAttribute:function(t,r){var n,c;if(mParticle.sessionManager.resetSessionTimer(),i.canLog()){if(!d.isValidAttributeValue(r))return void mParticle.Logger.error(u.ErrorMessages.BadAttribute);if(!d.isValidKeyValue(t))return void mParticle.Logger.error(u.ErrorMessages.BadKey);if(mParticle.Store.webviewBridgeEnabled)l.sendToNative(o.NativeSdkPaths.SetUserAttribute,JSON.stringify({key:t,value:r}));else{n=s.getPersistence(),c=this.getAllUserAttributes();var g=i.findKeyInObject(c,t);g&&delete c[g],c[t]=r,n&&n[e]&&(n[e].ua=c,s.saveCookies(n,e)),a.initForwarders(b.getCurrentUser().getUserIdentities()),a.callSetUserAttributeOnForwarders(t,r)}}},setUserAttributes:function(e){if(mParticle.sessionManager.resetSessionTimer(),i.isObject(e)){if(i.canLog())for(var t in e)e.hasOwnProperty(t)&&this.setUserAttribute(t,e[t])}else mParticle.Logger.error("Must pass an object into setUserAttributes. You passed a "+typeof e)},removeUserAttribute:function(t){var r,n;if(mParticle.sessionManager.resetSessionTimer(),d.isValidKeyValue(t))if(mParticle.Store.webviewBridgeEnabled)l.sendToNative(o.NativeSdkPaths.RemoveUserAttribute,JSON.stringify({key:t,value:null}));else{r=s.getPersistence(),n=this.getAllUserAttributes();var c=i.findKeyInObject(n,t);c&&(t=c),delete n[t],r&&r[e]&&(r[e].ua=n,s.saveCookies(r,e)),a.initForwarders(b.getCurrentUser().getUserIdentities()),a.applyToForwarders("removeUserAttribute",t)}else mParticle.Logger.error(u.ErrorMessages.BadKey)},setUserAttributeList:function(t,r){var n,c;if(mParticle.sessionManager.resetSessionTimer(),d.isValidKeyValue(t))if(Array.isArray(r)){var g=r.slice();if(mParticle.Store.webviewBridgeEnabled)l.sendToNative(o.NativeSdkPaths.SetUserAttributeList,JSON.stringify({key:t,value:g}));else{n=s.getPersistence(),c=this.getAllUserAttributes();var m=i.findKeyInObject(c,t);m&&delete c[m],c[t]=g,n&&n[e]&&(n[e].ua=c,s.saveCookies(n,e)),a.initForwarders(b.getCurrentUser().getUserIdentities()),a.callSetUserAttributeOnForwarders(t,g)}}else mParticle.Logger.error("The value you passed in to setUserAttributeList must be an array. You passed in a "+typeof r);else mParticle.Logger.error(u.ErrorMessages.BadKey)},removeAllUserAttributes:function(){var t,r;if(mParticle.sessionManager.resetSessionTimer(),mParticle.Store.webviewBridgeEnabled)l.sendToNative(o.NativeSdkPaths.RemoveAllUserAttributes);else{if(t=s.getPersistence(),r=this.getAllUserAttributes(),a.initForwarders(b.getCurrentUser().getUserIdentities()),r)for(var i in r)r.hasOwnProperty(i)&&a.applyToForwarders("removeUserAttribute",i);t&&t[e]&&(t[e].ua={},s.saveCookies(t,e))}},getUserAttributesLists:function(){var e,t={};for(var r in e=this.getAllUserAttributes())e.hasOwnProperty(r)&&Array.isArray(e[r])&&(t[r]=e[r].slice());return t},getAllUserAttributes:function(){var t={},r=s.getAllUserAttributes(e);if(r)for(var i in r)r.hasOwnProperty(i)&&(Array.isArray(r[i])?t[i]=r[i].slice():t[i]=r[i]);return t},getCart:function(){return A(e)},getConsentState:function(){return s.getConsentState(e)},setConsentState:function(t){s.saveUserConsentStateToCookies(e,t),a.initForwarders(this.getUserIdentities().userIdentities)},isLoggedIn:function(){return t},getLastSeenTime:function(){return s.getLastSeenTime(e)},getFirstSeenTime:function(){return s.getFirstSeenTime(e)}}}function A(e){return{add:function(t,r){var n,a,u;if((u=Array.isArray(t)?t.slice():[t]).forEach(function(e){e.Attributes=i.sanitizeAttributes(e.Attributes)}),mParticle.Store.webviewBridgeEnabled)l.sendToNative(o.NativeSdkPaths.AddToCart,JSON.stringify(u));else{mParticle.sessionManager.resetSessionTimer(),a=(a=s.getUserProductsFromLS(e)).concat(u),!0===r&&p.logProductActionEvent(c.ProductActionType.AddToCart,u);a.length>mParticle.Store.SDKConfig.maxProducts&&(mParticle.Logger.verbose("The cart contains "+a.length+" items. Only "+mParticle.Store.SDKConfig.maxProducts+" can currently be saved in cookies."),a=a.slice(-mParticle.Store.SDKConfig.maxProducts)),(n=s.getAllUserProductsFromLS())[e].cp=a,s.setCartProducts(n)}},remove:function(t,r){var i,n,a=-1,u=null;if(mParticle.Store.webviewBridgeEnabled)l.sendToNative(o.NativeSdkPaths.RemoveFromCart,JSON.stringify(t));else{mParticle.sessionManager.resetSessionTimer(),(n=s.getUserProductsFromLS(e))&&(n.forEach(function(e,r){e.Sku===t.Sku&&(a=r,u=e)}),a>-1&&(n.splice(a,1),!0===r&&p.logProductActionEvent(c.ProductActionType.RemoveFromCart,u)));(i=s.getAllUserProductsFromLS())[e].cp=n,s.setCartProducts(i)}},clear:function(){var t;mParticle.Store.webviewBridgeEnabled?l.sendToNative(o.NativeSdkPaths.ClearCart):(mParticle.sessionManager.resetSessionTimer(),(t=s.getAllUserProductsFromLS())&&t[e]&&t[e].cp&&(t[e].cp=[],t[e].cp=[],s.setCartProducts(t)))},getCartProducts:function(){return s.getCartProducts(e)}}}function w(e,t,r,o,n){var u,l,d,g=mParticle.Identity.getCurrentUser(),v={},S=g?g.getUserIdentities().userIdentities:{};for(var C in S)v[c.IdentityType.getIdentityType(C)]=S[C];var A={};mParticle.Store.identityCallInFlight=!1;try{if(mParticle.Logger.verbose("Parsing identity response from server"),e.responseText&&(l=JSON.parse(e.responseText)).hasOwnProperty("is_logged_in")&&(mParticle.Store.isLoggedIn=l.is_logged_in),200===e.status){if("modify"===n)A=h.modifyUserIdentities(v,o.userIdentities),s.saveUserIdentitiesToCookies(g.getMPID(),A);else{if(l=JSON.parse(e.responseText),mParticle.Logger.verbose("Successfully parsed Identity Response"),(!g||g.getMPID()&&l.mpid&&l.mpid!==g.getMPID())&&(mParticle.Store.mpid=l.mpid,g&&s.setLastSeenTime(t),s.setFirstSeenTime(l.mpid)),"identify"===n&&g&&l.mpid===g.getMPID()&&s.setFirstSeenTime(l.mpid),d=mParticle.Store.currentSessionMPIDs.indexOf(l.mpid),mParticle.Store.sessionId&&l.mpid&&t!==l.mpid&&d<0&&mParticle.Store.currentSessionMPIDs.push(l.mpid),d>-1&&(mParticle.Store.currentSessionMPIDs=mParticle.Store.currentSessionMPIDs.slice(0,d).concat(mParticle.Store.currentSessionMPIDs.slice(d+1,mParticle.Store.currentSessionMPIDs.length)),mParticle.Store.currentSessionMPIDs.push(l.mpid)),s.saveUserIdentitiesToCookies(l.mpid,A),m.attemptCookieSync(t,l.mpid),y.checkIdentitySwap(t,l.mpid,mParticle.Store.currentSessionMPIDs),i.processQueuedEvents(mParticle.Store.eventQueue,l.mpid,!mParticle.Store.requireDelay,f,P,p.parseEventResponse),Object.keys(mParticle.Store.migrationData).length){A=mParticle.Store.migrationData.userIdentities||{};var w=mParticle.Store.migrationData.userAttributes||{};s.saveUserAttributesToCookies(l.mpid,w)}else o&&o.userIdentities&&Object.keys(o.userIdentities).length&&(A=h.modifyUserIdentities(v,o.userIdentities));s.saveUserIdentitiesToCookies(l.mpid,A),s.update(),s.findPrevCookiesBasedOnUI(o),mParticle.Store.context=l.context||mParticle.Store.context}if(u=b.getCurrentUser(),o&&o.onUserAlias&&i.Validators.isFunction(o.onUserAlias))try{mParticle.Logger.warning("Deprecated function onUserAlias will be removed in future releases"),o.onUserAlias(g,u)}catch(e){mParticle.Logger.error("There was an error with your onUserAlias function - "+e)}var I=s.getCookie()||s.getLocalStorage();u&&(s.storeDataInMemory(I,u.getMPID()),g&&u.getMPID()===g.getMPID()&&g.isLoggedIn()===u.isLoggedIn()||a.initForwarders(u.getUserIdentities().userIdentities),a.setForwarderUserIdentities(u.getUserIdentities().userIdentities),a.setForwarderOnIdentityComplete(u,n),a.setForwarderOnUserIdentified(u,n))}r?i.invokeCallback(r,e.status,l||null,u):l&&l.errors&&l.errors.length&&mParticle.Logger.error("Received HTTP response code of "+e.status+" - "+l.errors[0].message)}catch(t){r&&i.invokeCallback(r,e.status,l||null),mParticle.Logger.error("Error parsing JSON response from Identity server: "+t)}}e.exports={IdentityAPI:b,Identity:y,IdentityRequest:h,mParticleUser:C,mParticleUserCart:A}},function(e,t,r){var i=r(0),o=r(2),n=r(1),a=r(18),s=r(4),c=r(3);function u(e){var t=mParticle.Identity.getCurrentUser();!mParticle.Store.webviewBridgeEnabled&&mParticle.Store.configuredForwarders&&(mParticle.Store.configuredForwarders.sort(function(e,t){return e.settings.PriorityValue=e.settings.PriorityValue||0,t.settings.PriorityValue=t.settings.PriorityValue||0,-1*(e.settings.PriorityValue-t.settings.PriorityValue)}),mParticle.Store.activeForwarders=mParticle.Store.configuredForwarders.filter(function(r){if(!l(r.filteringConsentRuleValues,t))return!1;if(!d(r.filteringUserAttributeValue,t))return!1;if(!function(e,t){if((!t||!t.isLoggedIn())&&e)return!1;return!0}(r.excludeAnonymousUser,t))return!1;var o=i.filterUserIdentities(e,r.userIdentityFilters),n=i.filterUserAttributes(t?t.getAllUserAttributes():{},r.userAttributeFilters);return r.initialized||(r.init(r.settings,g,!1,null,n,o,mParticle.Store.SDKConfig.appVersion,mParticle.Store.SDKConfig.appName,mParticle.Store.SDKConfig.customFlags,mParticle.Store.clientId),r.initialized=!0),!0}))}function l(e,t){if(!e||!e.values||!e.values.length)return!0;if(!t)return!1;var r={},o=t.getConsentState();if(o){var n=o.getGDPRConsentState();if(n)for(var a in n)if(n.hasOwnProperty(a)){var s=i.generateHash("1"+a).toString();r[s]=n[a].Consented}}var c=!1;return e.values.forEach(function(e){if(!c){var t=e.consentPurpose,i=e.hasConsented;r.hasOwnProperty(t)&&r[t]===i&&(c=!0)}}),e.includeOnMatch===c}function d(e,t){if(!e||!i.isObject(e)||!Object.keys(e).length)return!0;var r,o,n;if(!t)return!1;n=t.getAllUserAttributes();var a=!1;try{if(n&&i.isObject(n)&&Object.keys(n).length)for(var s in n)if(n.hasOwnProperty(s)&&(r=i.generateHash(s).toString(),o=i.generateHash(n[s]).toString(),r===e.userAttributeName&&o===e.userAttributeValue)){a=!0;break}return!e||e.includeOnMatch===a}catch(e){return!0}}function g(e,t){var r,o=m();e&&e.isVisible&&(r={mid:e.id,esid:e.eventSubscriptionId,n:t.EventName,attrs:t.EventAttributes,sdk:t.SDKVersion,dt:t.EventDataType,et:t.EventCategory,dbg:t.Debug,ct:t.Timestamp,eec:t.ExpandedEventCount},i.hasFeatureFlag(n.Features.Batching)?(o.push(r),f(o)):s.sendSingleForwardingStatsToServer(r))}function m(){return c.forwardingStatsBatches.forwardingStatsEventQueue}function f(e){c.forwardingStatsBatches.forwardingStatsEventQueue=e}function v(e){var t=null,r=e,o={};for(var n in i.isObject(mParticle.Store.SDKConfig.kits)&&Object.keys(mParticle.Store.SDKConfig.kits).length>0?o=mParticle.Store.SDKConfig.kits:mParticle.preInit.forwarderConstructors.length>0&&mParticle.preInit.forwarderConstructors.forEach(function(e){o[e.name]=e}),o)if(n===r.name&&(r.isDebug===mParticle.Store.SDKConfig.isDevelopmentMode||r.isSandbox===mParticle.Store.SDKConfig.isDevelopmentMode)){(t=new o[n].constructor).id=r.moduleId,t.isSandbox=r.isDebug||r.isSandbox,t.hasSandbox="true"===r.hasDebugString,t.isVisible=r.isVisible,t.settings=r.settings,t.eventNameFilters=r.eventNameFilters,t.eventTypeFilters=r.eventTypeFilters,t.attributeFilters=r.attributeFilters,t.screenNameFilters=r.screenNameFilters,t.screenNameFilters=r.screenNameFilters,t.pageViewAttributeFilters=r.pageViewAttributeFilters,t.userIdentityFilters=r.userIdentityFilters,t.userAttributeFilters=r.userAttributeFilters,t.filteringEventAttributeValue=r.filteringEventAttributeValue,t.filteringUserAttributeValue=r.filteringUserAttributeValue,t.eventSubscriptionId=r.eventSubscriptionId,t.filteringConsentRuleValues=r.filteringConsentRuleValues,t.excludeAnonymousUser=r.excludeAnonymousUser,mParticle.Store.configuredForwarders.push(t);break}}function p(e){e.isDebug!==mParticle.Store.SDKConfig.isDevelopmentMode&&e.isProduction===mParticle.Store.SDKConfig.isDevelopmentMode||mParticle.Store.pixelConfigurations.push(e)}e.exports={initForwarders:u,applyToForwarders:function(e,t){mParticle.Store.activeForwarders.length&&mParticle.Store.activeForwarders.forEach(function(r){if(r[e])try{var i=r[e](t);i&&mParticle.Logger.verbose(i)}catch(e){mParticle.Logger.verbose(e)}})},sendEventToForwarders:function(e){var t,r,n,a=function(e,t){e.UserIdentities&&e.UserIdentities.length&&e.UserIdentities.forEach(function(r,o){i.inArray(t,r.Type)&&(e.UserIdentities.splice(o,1),o>0&&o--)})},s=function(e,t){var r;if(t)for(var o in e.EventAttributes)e.EventAttributes.hasOwnProperty(o)&&(r=i.generateHash(e.EventCategory+e.EventName+o),i.inArray(t,r)&&delete e.EventAttributes[o])},c=function(e,t){return!!(e&&e.length&&i.inArray(e,t))},u=[o.MessageType.PageEvent,o.MessageType.PageView,o.MessageType.Commerce];if(!mParticle.Store.webviewBridgeEnabled&&mParticle.Store.activeForwarders){r=i.generateHash(e.EventCategory+e.EventName),n=i.generateHash(e.EventCategory);for(var l=0;l<mParticle.Store.activeForwarders.length;l++){if(u.indexOf(e.EventDataType)>-1&&mParticle.Store.activeForwarders[l].filteringEventAttributeValue&&mParticle.Store.activeForwarders[l].filteringEventAttributeValue.eventAttributeName&&mParticle.Store.activeForwarders[l].filteringEventAttributeValue.eventAttributeValue){var d=null;if(e.EventAttributes)for(var g in e.EventAttributes){var m;(m=i.generateHash(g).toString())===mParticle.Store.activeForwarders[l].filteringEventAttributeValue.eventAttributeName&&(d={name:m,value:i.generateHash(e.EventAttributes[g]).toString()});break}var f=null!==d&&d.value===mParticle.Store.activeForwarders[l].filteringEventAttributeValue.eventAttributeValue;if(!(!0===mParticle.Store.activeForwarders[l].filteringEventAttributeValue.includeOnMatch?f:!f))continue}if(t={},t=i.extend(!0,t,e),(e.EventDataType!==o.MessageType.PageEvent||!c(mParticle.Store.activeForwarders[l].eventNameFilters,r)&&!c(mParticle.Store.activeForwarders[l].eventTypeFilters,n))&&(e.EventDataType!==o.MessageType.Commerce||!c(mParticle.Store.activeForwarders[l].eventTypeFilters,n))&&(e.EventDataType!==o.MessageType.PageView||!c(mParticle.Store.activeForwarders[l].screenNameFilters,r))&&(t.EventAttributes&&(e.EventDataType===o.MessageType.PageEvent?s(t,mParticle.Store.activeForwarders[l].attributeFilters):e.EventDataType===o.MessageType.PageView&&s(t,mParticle.Store.activeForwarders[l].pageViewAttributeFilters)),a(t,mParticle.Store.activeForwarders[l].userIdentityFilters),t.UserAttributes=i.filterUserAttributes(t.UserAttributes,mParticle.Store.activeForwarders[l].userAttributeFilters),mParticle.Logger.verbose("Sending message to forwarder: "+mParticle.Store.activeForwarders[l].name),mParticle.Store.activeForwarders[l].process)){var v=mParticle.Store.activeForwarders[l].process(t);v&&mParticle.Logger.verbose(v)}}}},callSetUserAttributeOnForwarders:function(e,t){mParticle.Store.activeForwarders.length&&mParticle.Store.activeForwarders.forEach(function(r){if(r.setUserAttribute&&r.userAttributeFilters&&!i.inArray(r.userAttributeFilters,i.generateHash(e)))try{var o=r.setUserAttribute(e,t);o&&mParticle.Logger.verbose(o)}catch(e){mParticle.Logger.error(e)}})},setForwarderUserIdentities:function(e){mParticle.Store.activeForwarders.forEach(function(t){var r=i.filterUserIdentities(e,t.userIdentityFilters);t.setUserIdentity&&r.forEach(function(e){var r=t.setUserIdentity(e.Identity,e.Type);r&&mParticle.Logger.verbose(r)})})},setForwarderOnUserIdentified:function(e){mParticle.Store.activeForwarders.forEach(function(t){var r=a.getFilteredMparticleUser(e.getMPID(),t);if(t.onUserIdentified){var i=t.onUserIdentified(r);i&&mParticle.Logger.verbose(i)}})},setForwarderOnIdentityComplete:function(e,t){var r;mParticle.Store.activeForwarders.forEach(function(i){var o=a.getFilteredMparticleUser(e.getMPID(),i);"identify"===t?i.onIdentifyComplete&&(r=i.onIdentifyComplete(o))&&mParticle.Logger.verbose(r):"login"===t?i.onLoginComplete&&(r=i.onLoginComplete(o))&&mParticle.Logger.verbose(r):"logout"===t?i.onLogoutComplete&&(r=i.onLogoutComplete(o))&&mParticle.Logger.verbose(r):"modify"===t&&i.onModifyComplete&&(r=i.onModifyComplete(o))&&mParticle.Logger.verbose(r)})},prepareForwardingStats:g,getForwarderStatsQueue:m,setForwarderStatsQueue:f,isEnabledForUserConsent:l,isEnabledForUserAttributes:d,configureForwarder:v,configurePixel:p,processForwarders:function(e){if(e)try{Array.isArray(e.kitConfigs)&&e.kitConfigs.length&&e.kitConfigs.forEach(function(e){v(e)}),Array.isArray(e.pixelConfigs)&&e.pixelConfigs.length&&e.pixelConfigs.forEach(function(e){p(e)}),u(mParticle.Store.SDKConfig.identifyRequest.userIdentities)}catch(e){mParticle.Logger.error("Config was not parsed propertly. Forwarders may not be initialized.")}else mParticle.Logger.warning("No config was passed. Cannot process forwarders")}}},function(e,t,r){var i=r(2),o=i.MessageType,n=i.ApplicationTransitionType,a=r(1),s=r(0),c=r(0).parseNumber;function u(e){return e?e.map(function(e){return function(e){return{id:s.parseStringOrNumber(e.Sku),nm:s.parseStringOrNumber(e.Name),pr:c(e.Price),qt:c(e.Quantity),br:s.parseStringOrNumber(e.Brand),va:s.parseStringOrNumber(e.Variant),ca:s.parseStringOrNumber(e.Category),ps:c(e.Position),cc:s.parseStringOrNumber(e.CouponCode),tpa:c(e.TotalAmount),attrs:e.Attributes}}(e)}):[]}function l(e){if(!e)return null;var t={},r=e.getGDPRConsentState();if(r){var i={};for(var o in t.gdpr=i,r)if(r.hasOwnProperty(o)){var n=r[o];t.gdpr[o]={},"boolean"==typeof n.Consented&&(i[o].c=n.Consented),"number"==typeof n.Timestamp&&(i[o].ts=n.Timestamp),"string"==typeof n.ConsentDocument&&(i[o].d=n.ConsentDocument),"string"==typeof n.Location&&(i[o].l=n.Location),"string"==typeof n.HardwareId&&(i[o].h=n.HardwareId)}}return t}e.exports={createEventObject:function(e,t,r,o,n){var c,u={},l=mParticle.Identity.getCurrentUser(),d=l?l.getUserIdentities().userIdentities:{},g=e===i.MessageType.OptOut?!mParticle.Store.isEnabled:null;if(r=s.sanitizeAttributes(r),mParticle.Store.sessionId||e==i.MessageType.OptOut||mParticle.Store.webviewBridgeEnabled){for(var m in d)u[i.IdentityType.getIdentityType(m)]=d[m];return e!==i.MessageType.SessionEnd&&(mParticle.Store.dateLastEventSent=new Date),c={EventName:t||e,EventCategory:o,UserAttributes:l?l.getAllUserAttributes():{},UserIdentities:u,Store:mParticle.Store.serverSettings,EventAttributes:r,SDKVersion:a.sdkVersion,SessionId:mParticle.Store.sessionId,EventDataType:e,Debug:mParticle.Store.SDKConfig.isDevelopmentMode,Location:mParticle.Store.currentPosition,OptOut:g,ExpandedEventCount:0,CustomFlags:n,AppVersion:mParticle.Store.SDKConfig.appVersion,ClientGeneratedId:mParticle.Store.clientId,DeviceId:mParticle.Store.deviceId,MPID:l?l.getMPID():null,ConsentState:l?l.getConsentState():null,IntegrationAttributes:mParticle.Store.integrationAttributes},e===i.MessageType.SessionEnd&&(c.SessionLength=mParticle.Store.dateLastEventSent.getTime()-mParticle.Store.sessionStartDate.getTime(),c.currentSessionMPIDs=mParticle.Store.currentSessionMPIDs,c.EventAttributes=mParticle.Store.sessionAttributes,mParticle.Store.currentSessionMPIDs=[]),c.Timestamp=mParticle.Store.dateLastEventSent.getTime(),c}return null},convertEventToDTO:function(e,t,r){var i={n:e.EventName,et:e.EventCategory,ua:e.UserAttributes,ui:e.UserIdentities,ia:e.IntegrationAttributes,str:e.Store,attrs:e.EventAttributes,sdk:e.SDKVersion,sid:e.SessionId,sl:e.SessionLength,dt:e.EventDataType,dbg:e.Debug,ct:e.Timestamp,lc:e.Location,o:e.OptOut,eec:e.ExpandedEventCount,av:e.AppVersion,cgid:e.ClientGeneratedId,das:e.DeviceId,mpid:e.MPID,smpids:e.currentSessionMPIDs},a=l(e.ConsentState);return a&&(i.con=a),e.EventDataType===o.AppStateTransition&&(i.fr=t,i.iu=!1,i.at=n.AppInit,i.lr=window.location.href||null,i.attrs=null),e.CustomFlags&&function(e,t){var r=[];for(var i in t.flags={},e.CustomFlags)r=[],e.CustomFlags.hasOwnProperty(i)&&(Array.isArray(e.CustomFlags[i])?e.CustomFlags[i].forEach(function(e){"number"!=typeof e&&"string"!=typeof e&&"boolean"!=typeof e||r.push(e.toString())}):"number"!=typeof e.CustomFlags[i]&&"string"!=typeof e.CustomFlags[i]&&"boolean"!=typeof e.CustomFlags[i]||r.push(e.CustomFlags[i].toString()),r.length&&(t.flags[i]=r))}(e,i),e.EventDataType===o.Commerce?(i.cu=r,e.ShoppingCart&&(i.sc={pl:u(e.ShoppingCart.ProductList)}),e.ProductAction?i.pd={an:e.ProductAction.ProductActionType,cs:c(e.ProductAction.CheckoutStep),co:e.ProductAction.CheckoutOptions,pl:u(e.ProductAction.ProductList),ti:e.ProductAction.TransactionId,ta:e.ProductAction.Affiliation,tcc:e.ProductAction.CouponCode,tr:c(e.ProductAction.TotalAmount),ts:c(e.ProductAction.ShippingAmount),tt:c(e.ProductAction.TaxAmount)}:e.PromotionAction?i.pm={an:e.PromotionAction.PromotionActionType,pl:e.PromotionAction.PromotionList.map(function(e){return{id:e.Id,nm:e.Name,cr:e.Creative,ps:e.Position?e.Position:0}})}:e.ProductImpressions&&(i.pi=e.ProductImpressions.map(function(e){return{pil:e.ProductImpressionList,pl:u(e.ProductList)}}))):e.EventDataType===o.Profile&&(i.pet=e.ProfileMessageType),i},convertToConsentStateDTO:l}},function(e,t){var r={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){try{if(window.btoa&&window.atob)return window.btoa(unescape(encodeURIComponent(e)))}catch(e){window.console.log("Error encoding cookie values into Base64:"+e)}return this._encode(e)},_encode:function(e){var t,o,n,a,s,c,u,l="",d=0;for(e=i.encode(e);d<e.length;)a=(t=e.charCodeAt(d++))>>2,s=(3&t)<<4|(o=e.charCodeAt(d++))>>4,c=(15&o)<<2|(n=e.charCodeAt(d++))>>6,u=63&n,isNaN(o)?c=u=64:isNaN(n)&&(u=64),l=l+r._keyStr.charAt(a)+r._keyStr.charAt(s)+r._keyStr.charAt(c)+r._keyStr.charAt(u);return l},decode:function(e){try{if(window.btoa&&window.atob)return decodeURIComponent(escape(window.atob(e)))}catch(e){}return r._decode(e)},_decode:function(e){var t,o,n,a,s,c,u="",l=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<e.length;)t=r._keyStr.indexOf(e.charAt(l++))<<2|(a=r._keyStr.indexOf(e.charAt(l++)))>>4,o=(15&a)<<4|(s=r._keyStr.indexOf(e.charAt(l++)))>>2,n=(3&s)<<6|(c=r._keyStr.indexOf(e.charAt(l++))),u+=String.fromCharCode(t),64!==s&&(u+=String.fromCharCode(o)),64!==c&&(u+=String.fromCharCode(n));return u=i.decode(u)}},i={encode:function(e){for(var t="",r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t+=String.fromCharCode(i):i>127&&i<2048?(t+=String.fromCharCode(i>>6|192),t+=String.fromCharCode(63&i|128)):(t+=String.fromCharCode(i>>12|224),t+=String.fromCharCode(i>>6&63|128),t+=String.fromCharCode(63&i|128))}return t},decode:function(e){for(var t="",r=0,i=0,o=0,n=0;r<e.length;)(i=e.charCodeAt(r))<128?(t+=String.fromCharCode(i),r++):i>191&&i<224?(o=e.charCodeAt(r+1),t+=String.fromCharCode((31&i)<<6|63&o),r+=2):(o=e.charCodeAt(r+1),n=e.charCodeAt(r+2),t+=String.fromCharCode((15&i)<<12|(63&o)<<6|63&n),r+=3);return t}};e.exports={forEach:function(e,t){var r,i;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),n=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(r=t),i=0;i<n;){var a;i in o&&(a=o[i],e.call(r,a,i,o)),i++}},map:function(e,t){var r,i,o;if(null===this)throw new TypeError(" this is null or not defined");var n=Object(this),a=n.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(r=t),i=new Array(a),o=0;o<a;){var s,c;o in n&&(s=n[o],c=e.call(r,s,o,n),i[o]=c),o++}return i},filter:function(e){"use strict";if(null==this)throw new TypeError;var t=Object(this),r=t.length>>>0;if("function"!=typeof e)throw new TypeError;for(var i=[],o=arguments.length>=2?arguments[1]:void 0,n=0;n<r;n++)if(n in t){var a=t[n];e.call(o,a,n,t)&&i.push(a)}return i},isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},Base64:r}},function(e,t,r){var i=r(1).Messages,o="mParticleAndroid",n="mParticle";function a(e){if(!e)return!1;var t=o+"_"+e+"_v2",r=n+"_"+e+"_v2";return!!(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers.hasOwnProperty(r))||(window.mParticle.uiwebviewBridgeName===r||!!window.hasOwnProperty(t))}function s(e,t){window.mParticleAndroid&&window.mParticleAndroid.hasOwnProperty(e)?(mParticle.Logger.verbose(i.InformationMessages.SendAndroid+e),window.mParticleAndroid[e](t)):mParticle.Store.SDKConfig.isIOS&&(mParticle.Logger.verbose(i.InformationMessages.SendIOS+e),c(e,t))}function c(e,t){var r=document.createElement("IFRAME");r.setAttribute("src","mp-sdk://"+e+"/"+encodeURIComponent(t)),document.documentElement.appendChild(r),r.parentNode.removeChild(r),r=null}function u(e,t,r){if(r){var a,s,u=window[o+"_"+r+"_v2"],l=n+"_"+r+"_v2";if(window.webkit&&window.webkit.messageHandlers&&window.webkit.messageHandlers[l]&&(a=window.webkit.messageHandlers[l]),window.mParticle.uiwebviewBridgeName===l&&(s=window.mParticle[l]),u&&u.hasOwnProperty(e))return mParticle.Logger.verbose(i.InformationMessages.SendAndroid+e),void u[e](t);a?(mParticle.Logger.verbose(i.InformationMessages.SendIOS+e),a.postMessage(JSON.stringify({path:e,value:t?JSON.parse(t):null}))):s&&(mParticle.Logger.verbose(i.InformationMessages.SendIOS+e),c(e,t))}}e.exports={isWebviewEnabled:function(e,t){return mParticle.Store.bridgeV2Available=a(e),mParticle.Store.bridgeV1Available=!!(mParticle.Store.SDKConfig.useNativeSdk||window.mParticleAndroid||mParticle.Store.SDKConfig.isIOS),2===t?mParticle.Store.bridgeV2Available:(!window.mParticle.uiwebviewBridgeName||window.mParticle.uiwebviewBridgeName===n+"_"+e+"_v2")&&t<2&&(mParticle.Store.bridgeV2Available||mParticle.Store.bridgeV1Available)},isBridgeV2Available:a,sendToNative:function(e,t){mParticle.Store.bridgeV2Available&&2===mParticle.Store.SDKConfig.minWebviewBridgeVersion?u(e,t,mParticle.Store.SDKConfig.requiredWebviewBridgeName):mParticle.Store.bridgeV2Available&&mParticle.Store.SDKConfig.minWebviewBridgeVersion<2?u(e,t,mParticle.Store.SDKConfig.requiredWebviewBridgeName):mParticle.Store.bridgeV1Available&&mParticle.Store.SDKConfig.minWebviewBridgeVersion<2&&s(e,t)},sendViaBridgeV1:s,sendViaBridgeV2:u}},function(e,t,r){var i=r(2),o=r(1),n=r(0),a=r(15),s=r(7),c=r(14),u=r(3),l=o.Messages,d=r(4).sendEventToServer,g=r(6).sendEventToForwarders;function m(e,t,r,i,o){mParticle.Logger.verbose(l.InformationMessages.StartingLogEvent+": "+t),n.canLog()?(p(),r&&(r=n.sanitizeAttributes(r)),d(s.createEventObject(e,t,r,i,o),g,f),u.update()):mParticle.Logger.verbose(l.InformationMessages.AbandonLogEvent)}function f(e){var t,r,i,o=new Date;if(e)try{if(mParticle.Logger.verbose("Parsing response from server"),(t=JSON.parse(e))&&t.Store){for(r in mParticle.Logger.verbose("Parsed store from response, updating local settings"),mParticle.Store.serverSettings||(mParticle.Store.serverSettings={}),t.Store)t.Store.hasOwnProperty(r)&&(!(i=t.Store[r]).Value||new Date(i.Expires)<o?mParticle.Store.serverSettings.hasOwnProperty(r)&&delete mParticle.Store.serverSettings[r]:mParticle.Store.serverSettings[r]=i);u.update()}}catch(e){mParticle.Logger.error("Error parsing JSON response from server: "+e.name)}}function v(e,t){mParticle.Logger.verbose(l.InformationMessages.StartingLogCommerceEvent),t=n.sanitizeAttributes(t),n.canLog()?(p(),mParticle.Store.webviewBridgeEnabled&&(e.ShoppingCart={}),t&&(e.EventAttributes=t),d(e,g,f),u.update()):mParticle.Logger.verbose(l.InformationMessages.AbandonLogEvent)}function p(){if(!mParticle.Store.webviewBridgeEnabled){var e=u.getCookie()||u.getLocalStorage();!mParticle.Store.sessionId&&e&&(e.sid?mParticle.Store.sessionId=e.sid:c.startNewSession())}}e.exports={logEvent:m,startTracking:function(e){if(mParticle.Store.isTracking){var t={coords:{latitude:mParticle.Store.currentPosition.lat,longitude:mParticle.Store.currentPosition.lng}};r(e,t)}else"geolocation"in navigator&&(mParticle.Store.watchPositionId=navigator.geolocation.watchPosition(function(t){mParticle.Store.currentPosition={lat:t.coords.latitude,lng:t.coords.longitude},r(e,t),e=null,mParticle.Store.isTracking=!0},function(){r(e),e=null,mParticle.Store.isTracking=!1}));function r(e,t){if(e)try{t?e(t):e()}catch(e){mParticle.Logger.error("Error invoking the callback passed to startTrackingLocation."),mParticle.Logger.error(e)}}},stopTracking:function(){mParticle.Store.isTracking&&(navigator.geolocation.clearWatch(mParticle.Store.watchPositionId),mParticle.Store.currentPosition=null,mParticle.Store.isTracking=!1)},logCheckoutEvent:function(e,t,r,o){var n=a.createCommerceEventObject(o);n&&(n.EventName+=a.getProductActionEventName(i.ProductActionType.Checkout),n.EventCategory=i.CommerceEventType.ProductCheckout,n.ProductAction={ProductActionType:i.ProductActionType.Checkout,CheckoutStep:e,CheckoutOptions:t,ProductList:n.ShoppingCart.ProductList},v(n,r))},logProductActionEvent:function(e,t,r,i){var o=a.createCommerceEventObject(i);o&&(o.EventCategory=a.convertProductActionToEventType(e),o.EventName+=a.getProductActionEventName(e),o.ProductAction={ProductActionType:e,ProductList:Array.isArray(t)?t:[t]},v(o,r))},logPurchaseEvent:function(e,t,r,o){var n=a.createCommerceEventObject(o);n&&(n.EventName+=a.getProductActionEventName(i.ProductActionType.Purchase),n.EventCategory=i.CommerceEventType.ProductPurchase,n.ProductAction={ProductActionType:i.ProductActionType.Purchase},n.ProductAction.ProductList=a.buildProductList(n,t),a.convertTransactionAttributesToProductAction(e,n.ProductAction),v(n,r))},logRefundEvent:function(e,t,r,o){if(e){var n=a.createCommerceEventObject(o);n&&(n.EventName+=a.getProductActionEventName(i.ProductActionType.Refund),n.EventCategory=i.CommerceEventType.ProductRefund,n.ProductAction={ProductActionType:i.ProductActionType.Refund},n.ProductAction.ProductList=a.buildProductList(n,t),a.convertTransactionAttributesToProductAction(e,n.ProductAction),v(n,r))}else mParticle.Logger.error(l.ErrorMessages.TransactionRequired)},logPromotionEvent:function(e,t,r,i){var o=a.createCommerceEventObject(i);o&&(o.EventName+=a.getPromotionActionEventName(e),o.EventCategory=a.convertPromotionActionToEventType(e),o.PromotionAction={PromotionActionType:e,PromotionList:[t]},v(o,r))},logImpressionEvent:function(e,t,r){var o=a.createCommerceEventObject(r);o&&(o.EventName+="Impression",o.EventCategory=i.CommerceEventType.ProductImpression,Array.isArray(e)||(e=[e]),o.ProductImpressions=[],e.forEach(function(e){o.ProductImpressions.push({ProductImpressionList:e.Name,ProductList:Array.isArray(e.Product)?e.Product:[e.Product]})}),v(o,t))},logOptOut:function(){mParticle.Logger.verbose(l.InformationMessages.StartingLogOptOut),d(s.createEventObject(i.MessageType.OptOut,null,null,i.EventType.Other),g,f)},logAST:function(){m(i.MessageType.AppStateTransition)},parseEventResponse:f,logCommerceEvent:v,addEventHandler:function(e,t,r,o,n){var a,s,c=[],u=function(e){mParticle.Logger.verbose("DOM event triggered, handling event"),m(i.MessageType.PageEvent,"function"==typeof r?r(a):r,"function"==typeof o?o(a):o,n||i.EventType.Other),(a.href&&"_blank"!==a.target||a.submit)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,setTimeout(function(){a.href?window.location.href=a.href:a.submit&&a.submit()},mParticle.Store.SDKConfig.timeout))};if(t)if("string"==typeof t?c=document.querySelectorAll(t):t.nodeType&&(c=[t]),c.length)for(mParticle.Logger.verbose("Found "+c.length+" element"+(c.length>1?"s":"")+", attaching event handlers"),s=0;s<c.length;s++)(a=c[s]).addEventListener?a.addEventListener(e,u,!1):a.attachEvent?a.attachEvent("on"+e,u):a["on"+e]=u;else mParticle.Logger.verbose("No elements found");else mParticle.Logger.error("Can't bind event, selector is required")},startNewSessionIfNeeded:p}},function(e,t,r){var i=r(8),o=r(2),n=r(1),a=r(0),s=r(9),c=r(12),u=r(14),l=r(15),d=r(19),g=r(20),m=r(3),f=m.getDeviceId,v=r(10),p=n.Messages,P=a.Validators,S=r(21),y=r(6),h=r(22),b=r(5).IdentityRequest,C=r(5).Identity,A=r(5).IdentityAPI,w=A.HTTPCodes,I=r(5).mParticleUserCart,T=r(5).mParticleUser,k=r(4),E=r(13);!function(t){Array.prototype.forEach||(Array.prototype.forEach=i.forEach),Array.prototype.map||(Array.prototype.map=i.map),Array.prototype.filter||(Array.prototype.filter=i.filter),Array.isArray||(Array.prototype.isArray=i.isArray);var r={config:t.mParticle?t.mParticle.config:{},Store:{},getDeviceId:f,generateHash:a.generateHash,sessionManager:u,cookieSyncManager:c,persistence:m,isIOS:!(!t.mParticle||!t.mParticle.isIOS)&&t.mParticle.isIOS,migrations:S,Identity:A,Validators:P,_Identity:C,_IdentityRequest:b,IdentityType:o.IdentityType,EventType:o.EventType,CommerceEventType:o.CommerceEventType,PromotionType:o.PromotionActionType,ProductActionType:o.ProductActionType,init:function(e,r){!r&&t.mParticle.config&&(t.console.warn("You did not pass a config object to mParticle.init(). Attempting to use the window.mParticle.config if it exists. Please note that in a future release, this may not work and mParticle will not initialize properly"),r=t.mParticle.config),r?!r.hasOwnProperty("requestConfig")||r.requestConfig?k.getSDKConfiguration(e,r,D):D(e,r):t.console.error("No config available on the window, please pass a config object to mParticle.init()")},setLogLevel:function(e){r.Logger.setLogLevel(e)},reset:function(e,i){r.Store&&delete r.Store,r.Store=new d(e),r.Store.isLocalStorageAvailable=m.determineLocalStorageAvailability(t.localStorage),v.stopTracking(),i||m.resetPersistence(),m.forwardingStatsBatches.uploadsTable={},m.forwardingStatsBatches.forwardingStatsEventQueue=[],r.preInit={readyQueue:[],pixelConfigurations:[],integrationDelays:{},featureFlags:{},forwarderConstructors:[],isDevelopmentMode:!1}},ready:function(e){r.Store.isInitialized&&"function"==typeof e?e():r.preInit.readyQueue.push(e)},getVersion:function(){return n.sdkVersion},setAppVersion:function(e){r.Store.SDKConfig.appVersion=e,m.update()},getAppName:function(){return r.Store.SDKConfig.appName},setAppName:function(e){r.Store.SDKConfig.appName=e},getAppVersion:function(){return r.Store.SDKConfig.appVersion},stopTrackingLocation:function(){u.resetSessionTimer(),v.stopTracking()},startTrackingLocation:function(e){P.isFunction(e)||r.Logger.warning("Warning: Location tracking is triggered, but not including a callback into the `startTrackingLocation` may result in events logged too quickly and not being associated with a location."),u.resetSessionTimer(),v.startTracking(e)},setPosition:function(e,t){u.resetSessionTimer(),"number"==typeof e&&"number"==typeof t?r.Store.currentPosition={lat:e,lng:t}:r.Logger.error("Position latitude and/or longitude must both be of type number")},startNewSession:function(){u.startNewSession()},endSession:function(){u.endSession(!0)},logEvent:function(e,t,i,n){u.resetSessionTimer(),"string"==typeof e?(t||(t=o.EventType.Unknown),a.isEventType(t)?a.canLog()?v.logEvent(o.MessageType.PageEvent,e,i,t,n):r.Logger.error(p.ErrorMessages.LoggingDisabled):r.Logger.error("Invalid event type: "+t+", must be one of: \n"+JSON.stringify(o.EventType))):r.Logger.error(p.ErrorMessages.EventNameInvalidType)},logError:function(e,t){if(u.resetSessionTimer(),e){"string"==typeof e&&(e={message:e});var r={m:e.message?e.message:e,s:"Error",t:e.stack};if(t){var i=a.sanitizeAttributes(t);for(var n in i)r[n]=i[n]}v.logEvent(o.MessageType.CrashReport,e.name?e.name:"Error",r,o.EventType.Other)}},logLink:function(e,t,r,i){u.resetSessionTimer(),v.addEventHandler("click",e,t,i,r)},logForm:function(e,t,r,i){u.resetSessionTimer(),v.addEventHandler("submit",e,t,i,r)},logPageView:function(e,i,n){if(u.resetSessionTimer(),a.canLog()){if(P.isStringOrNumber(e)||(e="PageView"),i){if(!a.isObject(i))return void r.Logger.error("The attributes argument must be an object. A "+typeof i+" was entered. Please correct and retry.")}else i={hostname:t.location.hostname,title:t.document.title};if(n&&!a.isObject(n))return void r.Logger.error("The customFlags argument must be an object. A "+typeof n+" was entered. Please correct and retry.")}v.logEvent(o.MessageType.PageView,e,i,o.EventType.Unknown,n)},Consent:{createGDPRConsent:E.createGDPRConsent,createConsentState:E.createConsentState},eCommerce:{Cart:{add:function(e,t){var i,o=r.Identity.getCurrentUser();o&&(i=o.getMPID()),I(i).add(e,t)},remove:function(e,t){var i,o=r.Identity.getCurrentUser();o&&(i=o.getMPID()),I(i).remove(e,t)},clear:function(){var e,t=r.Identity.getCurrentUser();t&&(e=t.getMPID()),I(e).clear()}},setCurrencyCode:function(e){"string"==typeof e?(u.resetSessionTimer(),r.Store.currencyCode=e):r.Logger.error("Code must be a string")},createProduct:function(e,t,r,i,o,n,a,s,c,d){return u.resetSessionTimer(),l.createProduct(e,t,r,i,o,n,a,s,c,d)},createPromotion:function(e,t,r,i){return u.resetSessionTimer(),l.createPromotion(e,t,r,i)},createImpression:function(e,t){return u.resetSessionTimer(),l.createImpression(e,t)},createTransactionAttributes:function(e,t,r,i,o,n){return u.resetSessionTimer(),l.createTransactionAttributes(e,t,r,i,o,n)},logCheckout:function(e,t,r,i){u.resetSessionTimer(),v.logCheckoutEvent(e,t,r,i)},logProductAction:function(e,t,r,i){u.resetSessionTimer(),v.logProductActionEvent(e,t,r,i)},logPurchase:function(e,t,i,o,n){e&&t?(u.resetSessionTimer(),v.logPurchaseEvent(e,t,o,n),!0===i&&r.eCommerce.Cart.clear()):r.Logger.error(p.ErrorMessages.BadLogPurchase)},logPromotion:function(e,t,r,i){u.resetSessionTimer(),v.logPromotionEvent(e,t,r,i)},logImpression:function(e,t,r){u.resetSessionTimer(),v.logImpressionEvent(e,t,r)},logRefund:function(e,t,i,o,n){u.resetSessionTimer(),v.logRefundEvent(e,t,o,n),!0===i&&r.eCommerce.Cart.clear()},expandCommerceEvent:function(e){return u.resetSessionTimer(),l.expandCommerceEvent(e)}},setSessionAttribute:function(e,t){if(u.resetSessionTimer(),a.canLog()){if(!P.isValidAttributeValue(t))return void r.Logger.error(p.ErrorMessages.BadAttribute);if(!P.isValidKeyValue(e))return void r.Logger.error(p.ErrorMessages.BadKey);if(r.Store.webviewBridgeEnabled)s.sendToNative(n.NativeSdkPaths.SetSessionAttribute,JSON.stringify({key:e,value:t}));else{var i=a.findKeyInObject(r.Store.sessionAttributes,e);i&&(e=i),r.Store.sessionAttributes[e]=t,m.update(),y.applyToForwarders("setSessionAttribute",[e,t])}}},setOptOut:function(e){u.resetSessionTimer(),r.Store.isEnabled=!e,v.logOptOut(),m.update(),r.Store.activeForwarders.length&&r.Store.activeForwarders.forEach(function(t){if(t.setOptOut){var i=t.setOptOut(e);i&&r.Logger.verbose(i)}})},setIntegrationAttribute:function(e,t){if("number"==typeof e){if(null===t)r.Store.integrationAttributes[e]={};else{if(!a.isObject(t))return void r.Logger.error("Attrs must be an object with keys and values. You entered a "+typeof t);if(0===Object.keys(t).length)r.Store.integrationAttributes[e]={};else for(var i in t)"string"==typeof i?"string"==typeof t[i]?a.isObject(r.Store.integrationAttributes[e])?r.Store.integrationAttributes[e][i]=t[i]:(r.Store.integrationAttributes[e]={},r.Store.integrationAttributes[e][i]=t[i]):r.Logger.error("Values for integration attributes must be strings. You entered a "+typeof t[i]):r.Logger.error("Keys must be strings, you entered a "+typeof i)}m.update()}else r.Logger.error("integrationId must be a number")},getIntegrationAttributes:function(e){return r.Store.integrationAttributes[e]?r.Store.integrationAttributes[e]:{}},addForwarder:function(e){r.preInit.forwarderConstructors.push(e)},configurePixel:function(e){y.configurePixel(e)},_getActiveForwarders:function(){return r.Store.activeForwarders},_getIntegrationDelays:function(){return r.preInit.integrationDelays},_configureFeatures:function(e){for(var t in e)r.Store&&r.preInit.featureFlags&&(r.preInit.featureFlags[t]=e[t])},_setIntegrationDelay:function(e,t){r.preInit.integrationDelays[e]=t}};function D(e,i){if(r.Logger=new g(i),r.Store=new d(i,r.Logger),r.Store.webviewBridgeEnabled=s.isWebviewEnabled(r.Store.SDKConfig.requiredWebviewBridgeName,r.Store.SDKConfig.minWebviewBridgeVersion),r.Store.webviewBridgeEnabled)s.sendToNative(n.NativeSdkPaths.SetSessionAttribute,JSON.stringify({key:"$src_env",value:"webview"})),e&&s.sendToNative(n.NativeSdkPaths.SetSessionAttribute,JSON.stringify({key:"$src_key",value:e}));else{var o;if(r.Store.devToken=e||null,r.Logger.verbose(p.InformationMessages.StartingInitialization),r.Store.isLocalStorageAvailable=m.determineLocalStorageAvailability(t.localStorage),S.migrate(),m.initializeStorage(),a.isObject(r.Store.SDKConfig.identifyRequest)&&a.isObject(r.Store.SDKConfig.identifyRequest.userIdentities)&&0===Object.keys(r.Store.SDKConfig.identifyRequest.userIdentities).length||!r.Store.SDKConfig.identifyRequest){var c={};if(o=r.Identity.getCurrentUser()){var u=o.getUserIdentities().userIdentities||{};for(var l in u)u.hasOwnProperty(l)&&(c[l]=u[l])}r.Store.SDKConfig.identifyRequest={userIdentities:c}}r.Store.migratingToIDSyncCookies&&(A.identify(r.Store.SDKConfig.identifyRequest,r.Store.SDKConfig.identityCallback),r.Store.migratingToIDSyncCookies=!1),o=A.getCurrentUser(),!r.Store.identifyCalled&&r.Store.SDKConfig.identityCallback&&o&&o.getMPID()&&r.Store.SDKConfig.identityCallback({httpCode:w.activeSession,getUser:function(){return T(o.getMPID())},getPreviousUser:function(){var e=r.Identity.getUsers(),t=e.shift();return t&&o&&t.getMPID()===o.getMPID()&&(t=e.shift()),t||null},body:{mpid:o.getMPID(),is_logged_in:r.Store.isLoggedIn,matched_identities:o.getUserIdentities().userIdentities,context:null,is_ephemeral:!1}}),a.hasFeatureFlag(n.Features.Batching)&&h.startForwardingStatsTimer(),y.processForwarders(i),r.sessionManager.initialize(),v.logAST()}r.preInit.readyQueue&&r.preInit.readyQueue.length&&(r.preInit.readyQueue.forEach(function(e){P.isFunction(e)?e():Array.isArray(e)&&function(e){var t=e,i=t.splice(0,1)[0];if(r[t[0]])r[i].apply(this,t);else{var o=i.split(".");try{for(var n=r,a=0;a<o.length;a++){var s=o[a];n=n[s]}n.apply(void 0,t)}catch(e){r.Logger.verbose("Unable to compute proper mParticle function "+e)}}}(e)}),r.preInit.readyQueue=[]),r.Store.isInitialized=!0,r.Store.isFirstRun&&(r.Store.isFirstRun=!1)}r.preInit={readyQueue:[],featureFlags:{},integrationDelays:{},isDevelopmentMode:!1,forwarderConstructors:[]},t.mParticle&&t.mParticle.config&&t.mParticle.config.hasOwnProperty("rq")&&(r.preInit.readyQueue=t.mParticle.config.rq),t.mParticle=r,e.exports=r}(window)},function(e,t,r){var i=r(1),o=r(3),n=i.Messages,a={attemptCookieSync:function(e,t){var r,i,n,s,c;t&&!mParticle.Store.webviewBridgeEnabled&&mParticle.Store.pixelConfigurations.forEach(function(u){r={moduleId:u.moduleId,frequencyCap:u.frequencyCap,pixelUrl:a.replaceAmp(u.pixelUrl),redirectUrl:u.redirectUrl?a.replaceAmp(u.redirectUrl):null},n=a.replaceMPID(r.pixelUrl,t),s=r.redirectUrl?a.replaceMPID(r.redirectUrl,t):"",c=n+encodeURIComponent(s);var l=o.getPersistence();e&&e!==t?l&&l[t]&&(l[t].csd||(l[t].csd={}),a.performCookieSync(c,r.moduleId,t,l[t].csd)):l[t]&&(l[t].csd||(l[t].csd={}),(i=l[t].csd[r.moduleId.toString()]?l[t].csd[r.moduleId.toString()]:null)?(new Date).getTime()>new Date(i).getTime()+60*r.frequencyCap*1e3*60*24&&a.performCookieSync(c,r.moduleId,t,l[t].csd):a.performCookieSync(c,r.moduleId,t,l[t].csd))})},performCookieSync:function(e,t,r,i){var a=document.createElement("img");mParticle.Logger.verbose(n.InformationMessages.CookieSync),a.src=e,i[t.toString()]=(new Date).getTime(),o.saveUserCookieSyncDatesToCookies(r,i)},replaceMPID:function(e,t){return e.replace("%%mpid%%",t)},replaceAmp:function(e){return e.replace(/&amp;/g,"&")}};e.exports=a},function(e,t,r){var i=r(0);function o(e,t,r,i,o){return"boolean"!=typeof e?(mParticle.Logger.error("Consented boolean is required when constructing a GDPR Consent object."),null):t&&isNaN(t)?(mParticle.Logger.error("Timestamp must be a valid number when constructing a GDPR Consent object."),null):r&&"string"!=typeof r?(mParticle.Logger.error("Document must be a valid string when constructing a GDPR Consent object."),null):i&&"string"!=typeof i?(mParticle.Logger.error("Location must be a valid string when constructing a GDPR Consent object."),null):o&&"string"!=typeof o?(mParticle.Logger.error("Hardware ID must be a valid string when constructing a GDPR Consent object."),null):{Consented:e,Timestamp:t||Date.now(),ConsentDocument:r,Location:i,HardwareId:o}}var n={toMinifiedJsonObject:function(e){var t={};if(e){var r=e.getGDPRConsentState();if(r)for(var i in t.gdpr={},r)if(r.hasOwnProperty(i)){var o=r[i];t.gdpr[i]={},"boolean"==typeof o.Consented&&(t.gdpr[i].c=o.Consented),"number"==typeof o.Timestamp&&(t.gdpr[i].ts=o.Timestamp),"string"==typeof o.ConsentDocument&&(t.gdpr[i].d=o.ConsentDocument),"string"==typeof o.Location&&(t.gdpr[i].l=o.Location),"string"==typeof o.HardwareId&&(t.gdpr[i].h=o.HardwareId)}}return t},fromMinifiedJsonObject:function(e){var t=a();if(e.gdpr)for(var r in e.gdpr)if(e.gdpr.hasOwnProperty(r)){var i=o(e.gdpr[r].c,e.gdpr[r].ts,e.gdpr[r].d,e.gdpr[r].l,e.gdpr[r].h);t.addGDPRConsentState(r,i)}return t}};function a(e){var t={};function r(e){if("string"!=typeof e)return null;var t=e.trim();return t.length?t.toLowerCase():null}function n(e){if(e){if(i.isObject(e))for(var r in t={},e)e.hasOwnProperty(r)&&a(r,e[r])}else t={};return this}function a(e,n){var a=r(e);if(!a)return mParticle.Logger.error("addGDPRConsentState() invoked with bad purpose. Purpose must be a string."),this;if(!i.isObject(n))return mParticle.Logger.error("addGDPRConsentState() invoked with bad or empty GDPR consent object."),this;var s=o(n.Consented,n.Timestamp,n.ConsentDocument,n.Location,n.HardwareId);return s&&(t[a]=s),this}return e&&n(e.getGDPRConsentState()),{setGDPRConsentState:n,addGDPRConsentState:a,getGDPRConsentState:function(){return i.extend({},t)},removeGDPRConsentState:function(e){var i=r(e);return i?(delete t[i],this):this}}}e.exports={createGDPRConsent:o,Serialization:n,createConsentState:a}},function(e,t,r){var i=r(0),o=r(1).Messages,n=r(2),a=r(5).IdentityAPI,s=r(3),c=r(10).logEvent;function u(){if(mParticle.Logger.verbose(o.InformationMessages.StartingNewSession),i.canLog()){mParticle.Store.sessionId=i.generateUniqueId().toUpperCase();var e=mParticle.Identity.getCurrentUser(),t=e?e.getMPID():null;if(t&&(mParticle.Store.currentSessionMPIDs=[t]),!mParticle.Store.sessionStartDate){var r=new Date;mParticle.Store.sessionStartDate=r,mParticle.Store.dateLastEventSent=r}d(),mParticle.Store.identifyCalled||(a.identify(mParticle.Store.SDKConfig.identifyRequest,mParticle.Store.SDKConfig.identityCallback),mParticle.Store.identifyCalled=!0,mParticle.Store.SDKConfig.identityCallback=null),c(n.MessageType.SessionStart)}else mParticle.Logger.verbose(o.InformationMessages.AbandonStartSession)}function l(e){if(mParticle.Logger.verbose(o.InformationMessages.StartingEndSession),e)c(n.MessageType.SessionEnd),mParticle.Store.sessionId=null,mParticle.Store.dateLastEventSent=null,mParticle.Store.sessionAttributes={},s.update();else if(i.canLog()){var t,r;if(!(r=s.getCookie()||s.getLocalStorage()))return;if(r.gs&&!r.gs.sid)return void mParticle.Logger.verbose(o.InformationMessages.NoSessionToEnd);if(r.gs.sid&&mParticle.Store.sessionId!==r.gs.sid&&(mParticle.Store.sessionId=r.gs.sid),r.gs&&r.gs.les)t=6e4*mParticle.Store.SDKConfig.sessionTimeout,(new Date).getTime()-r.gs.les<t?d():(c(n.MessageType.SessionEnd),mParticle.Store.sessionId=null,mParticle.Store.dateLastEventSent=null,mParticle.Store.sessionStartDate=null,mParticle.Store.sessionAttributes={},s.update())}else mParticle.Logger.verbose(o.InformationMessages.AbandonEndSession)}function d(){var e=6e4*mParticle.Store.SDKConfig.sessionTimeout;mParticle.Store.globalTimer=window.setTimeout(function(){l()},e)}function g(){clearTimeout(mParticle.Store.globalTimer)}e.exports={initialize:function(){if(mParticle.Store.sessionId){var e=6e4*mParticle.Store.SDKConfig.sessionTimeout;if(new Date>new Date(mParticle.Store.dateLastEventSent.getTime()+e))l(),u();else{var t=s.getPersistence();t&&!t.cu&&(a.identify(mParticle.Store.SDKConfig.identifyRequest,mParticle.Store.SDKConfig.identityCallback),mParticle.Store.identifyCalled=!0,mParticle.Store.SDKConfig.identityCallback=null)}}else u()},getSession:function(){return mParticle.Store.sessionId},startNewSession:u,endSession:l,setSessionTimer:d,resetSessionTimer:function(){mParticle.Store.webviewBridgeEnabled||(mParticle.Store.sessionId||u(),g(),d())},clearSessionTimeout:g}},function(e,t,r){var i=r(2),o=r(0),n=o.Validators,a=r(1).Messages,s=r(7);function c(e,t){return"eCommerce - "+e+" - "+(t?"Total":"Item")}function u(e,t){t.CouponCode&&(e["Coupon Code"]=t.CouponCode),t.Brand&&(e.Brand=t.Brand),t.Category&&(e.Category=t.Category),t.Name&&(e.Name=t.Name),t.Sku&&(e.Id=t.Sku),t.Price&&(e["Item Price"]=t.Price),t.Quantity&&(e.Quantity=t.Quantity),t.Position&&(e.Position=t.Position),t.Variant&&(e.Variant=t.Variant),e["Total Product Amount"]=t.TotalAmount||0}function l(e,t){t.TransactionId&&(e["Transaction Id"]=t.TransactionId)}function d(e,t){l(e,t),t.Affiliation&&(e.Affiliation=t.Affiliation),t.CouponCode&&(e["Coupon Code"]=t.CouponCode),t.TotalAmount&&(e["Total Amount"]=t.TotalAmount),t.ShippingAmount&&(e["Shipping Amount"]=t.ShippingAmount),t.TaxAmount&&(e["Tax Amount"]=t.TaxAmount),t.CheckoutOptions&&(e["Checkout Options"]=t.CheckoutOptions),t.CheckoutStep&&(e["Checkout Step"]=t.CheckoutStep)}function g(e,t){t.Id&&(e.Id=t.Id),t.Creative&&(e.Creative=t.Creative),t.Name&&(e.Name=t.Name),t.Position&&(e.Position=t.Position)}e.exports={convertTransactionAttributesToProductAction:function(e,t){t.TransactionId=e.Id,t.Affiliation=e.Affiliation,t.CouponCode=e.CouponCode,t.TotalAmount=e.Revenue,t.ShippingAmount=e.Shipping,t.TaxAmount=e.Tax},getProductActionEventName:function(e){switch(e){case i.ProductActionType.AddToCart:return"AddToCart";case i.ProductActionType.AddToWishlist:return"AddToWishlist";case i.ProductActionType.Checkout:return"Checkout";case i.ProductActionType.CheckoutOption:return"CheckoutOption";case i.ProductActionType.Click:return"Click";case i.ProductActionType.Purchase:return"Purchase";case i.ProductActionType.Refund:return"Refund";case i.ProductActionType.RemoveFromCart:return"RemoveFromCart";case i.ProductActionType.RemoveFromWishlist:return"RemoveFromWishlist";case i.ProductActionType.ViewDetail:return"ViewDetail";case i.ProductActionType.Unknown:default:return"Unknown"}},getPromotionActionEventName:function(e){switch(e){case i.PromotionActionType.PromotionClick:return"PromotionClick";case i.PromotionActionType.PromotionView:return"PromotionView";default:return"Unknown"}},convertProductActionToEventType:function(e){switch(e){case i.ProductActionType.AddToCart:return i.CommerceEventType.ProductAddToCart;case i.ProductActionType.AddToWishlist:return i.CommerceEventType.ProductAddToWishlist;case i.ProductActionType.Checkout:return i.CommerceEventType.ProductCheckout;case i.ProductActionType.CheckoutOption:return i.CommerceEventType.ProductCheckoutOption;case i.ProductActionType.Click:return i.CommerceEventType.ProductClick;case i.ProductActionType.Purchase:return i.CommerceEventType.ProductPurchase;case i.ProductActionType.Refund:return i.CommerceEventType.ProductRefund;case i.ProductActionType.RemoveFromCart:return i.CommerceEventType.ProductRemoveFromCart;case i.ProductActionType.RemoveFromWishlist:return i.CommerceEventType.ProductRemoveFromWishlist;case i.ProductActionType.Unknown:return i.EventType.Unknown;case i.ProductActionType.ViewDetail:return i.CommerceEventType.ProductViewDetail;default:return mParticle.Logger.error("Could not convert product action type "+e+" to event type"),null}},convertPromotionActionToEventType:function(e){switch(e){case i.PromotionActionType.PromotionClick:return i.CommerceEventType.PromotionClick;case i.PromotionActionType.PromotionView:return i.CommerceEventType.PromotionView;default:return mParticle.Logger.error("Could not convert promotion action type "+e+" to event type"),null}},generateExpandedEcommerceName:c,extractProductAttributes:u,extractActionAttributes:d,extractPromotionAttributes:g,extractTransactionId:l,buildProductList:function(e,t){return t?Array.isArray(t)?t:[t]:e.ShoppingCart.ProductList},createProduct:function(e,t,r,i,a,s,c,u,l,d){return d=o.sanitizeAttributes(d),"string"!=typeof e?(mParticle.Logger.error("Name is required when creating a product"),null):n.isStringOrNumber(t)?n.isStringOrNumber(r)?(i||(i=1),{Name:e,Sku:t,Price:r,Quantity:i,Brand:c,Variant:a,Category:s,Position:u,CouponCode:l,TotalAmount:i*r,Attributes:d}):(mParticle.Logger.error("Price is required when creating a product, and must be a string or a number"),null):(mParticle.Logger.error("SKU is required when creating a product, and must be a string or a number"),null)},createPromotion:function(e,t,r,i){return n.isStringOrNumber(e)?{Id:e,Creative:t,Name:r,Position:i}:(mParticle.Logger.error(a.ErrorMessages.PromotionIdRequired),null)},createImpression:function(e,t){return"string"!=typeof e?(mParticle.Logger.error("Name is required when creating an impression."),null):t?{Name:e,Product:t}:(mParticle.Logger.error("Product is required when creating an impression."),null)},createTransactionAttributes:function(e,t,r,i,o,s){return n.isStringOrNumber(e)?{Id:e,Affiliation:t,CouponCode:r,Revenue:i,Shipping:o,Tax:s}:(mParticle.Logger.error(a.ErrorMessages.TransactionIdRequired),null)},expandCommerceEvent:function(e){return e?function(e){var t=[];if(!e.ProductAction)return t;var r=!1;if(e.ProductAction.ProductActionType===i.ProductActionType.Purchase||e.ProductAction.ProductActionType===i.ProductActionType.Refund){var n=o.extend(!1,{},e.EventAttributes);n["Product Count"]=e.ProductAction.ProductList?e.ProductAction.ProductList.length:0,d(n,e.ProductAction),e.CurrencyCode&&(n["Currency Code"]=e.CurrencyCode);var a=s.createEventObject(i.MessageType.PageEvent,c(i.ProductActionType.getExpansionName(e.ProductAction.ProductActionType),!0),n,i.EventType.Transaction);t.push(a)}else r=!0;var g=e.ProductAction.ProductList;return g?(g.forEach(function(n){var a=o.extend(!1,e.EventAttributes,n.Attributes);r?d(a,e.ProductAction):l(a,e.ProductAction),u(a,n);var g=s.createEventObject(i.MessageType.PageEvent,c(i.ProductActionType.getExpansionName(e.ProductAction.ProductActionType)),a,i.EventType.Transaction);t.push(g)}),t):t}(e).concat(function(e){var t=[];return e.PromotionAction?(e.PromotionAction.PromotionList.forEach(function(r){var n=o.extend(!1,{},e.EventAttributes);g(n,r);var a=s.createEventObject(i.MessageType.PageEvent,c(i.PromotionActionType.getExpansionName(e.PromotionAction.PromotionActionType)),n,i.EventType.Transaction);t.push(a)}),t):t}(e)).concat((r=[],(t=e).ProductImpressions?(t.ProductImpressions.forEach(function(e){e.ProductList&&e.ProductList.forEach(function(n){var a=o.extend(!1,{},t.EventAttributes);if(n.Attributes)for(var l in n.Attributes)a[l]=n.Attributes[l];u(a,n),e.ProductImpressionList&&(a["Product Impression List"]=e.ProductImpressionList);var d=s.createEventObject(i.MessageType.PageEvent,c("Impression"),a,i.EventType.Transaction);r.push(d)})}),r):r)):null;var t,r},createCommerceEventObject:function(e){var t,r=mParticle.Identity.getCurrentUser();return mParticle.Logger.verbose(a.InformationMessages.StartingLogCommerceEvent),o.canLog()?((t=s.createEventObject(i.MessageType.Commerce)).EventName="eCommerce - ",t.CurrencyCode=mParticle.Store.currencyCode,t.ShoppingCart={ProductList:r?r.getCart().getCartProducts():[]},t.CustomFlags=e,t):(mParticle.Logger.verbose(a.InformationMessages.AbandonLogEvent),null)}}},function(e,t,r){!function(e){var t=function(e,t){return e(t={exports:{}},t.exports),t.exports}(function(e){!function(t){var r="GoogleAnalyticsEventForwarder",i=6,o={SessionStart:1,SessionEnd:2,PageView:3,PageEvent:4,CrashReport:5,OptOut:6,Commerce:16},n=1,a="Google.NonInteraction",s="Google.Category",c="Google.Label",u="Google.Page",l="Google.Value",d="Google.HitType",g=function(){var e,i,g=this,m=!1,f=!1,v=null,p={customDimensions:{},customMetrics:{}},P={customDimensions:{},customMetrics:{}},S={customDimensions:{},customMetrics:{}};function y(e){return v+"."+e}function h(e){return mParticle.EventType.getName(e)}function b(e){return e.replace(/ /g,"").toLowerCase()}function C(e,t,r){for(var i in r.customDimensions)for(attrName in e)r.customDimensions[i]===attrName&&(t[i]=e[attrName]);for(var o in r.customMetrics)for(attrName in e)r.customMetrics[o]===attrName&&(t[o]=e[attrName])}function A(e,t){var r={id:e.Sku,name:e.Name,category:e.Category,brand:e.Brand,variant:e.Variant,price:e.Price,coupon:e.CouponCode,quantity:e.Quantity};for(var i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);ga(y("ec:addProduct"),r)}function w(e,t,r){ga(y("send"),r&&r[d]?r[d]:"event","eCommerce",h(e),t)}function I(e,t,r){if(f||(ga(y("require"),"ec"),f=!0),e.CurrencyCode&&ga(y("set"),"&cu",e.CurrencyCode),e.ProductImpressions)e.ProductImpressions.forEach(function(e){e.ProductList.forEach(function(e){!function(e){ga(y("ec:addImpression"),{id:e.Sku,name:e.Name,type:"view",category:e.Category,brand:e.Brand,variant:e.Variant})}(e)})}),w(e.EventCategory,t,r);else if(e.PromotionAction)e.PromotionAction.PromotionList.forEach(function(e){ga(y("ec:addPromo"),{id:e.Id,name:e.Name,creative:e.Creative,position:e.Position})}),e.PromotionAction.PromotionActionType==mParticle.PromotionType.PromotionClick&&ga(y("ec:setAction"),"promo_click"),w(e.EventDataType,t,r);else if(e.ProductAction)if(e.ProductAction.ProductActionType==mParticle.ProductActionType.Purchase)e.ProductAction.ProductList.forEach(function(e){var t={};C(e.Attributes,t,S),A(e,t)}),ga(y("ec:setAction"),"purchase",{id:e.ProductAction.TransactionId,affiliation:e.ProductAction.Affiliation,revenue:e.ProductAction.TotalAmount,tax:e.ProductAction.TaxAmount,shipping:e.ProductAction.ShippingAmount,coupon:e.ProductAction.CouponCode}),w(e.EventDataType,t,r);else if(e.ProductAction.ProductActionType==mParticle.ProductActionType.Refund)e.ProductAction.ProductList.length&&e.ProductAction.ProductList.forEach(function(e){var t={id:e.Sku,quantity:e.Quantity};C(e.Attributes,t,S),ga(y("ec:addProduct"),t)}),ga(y("ec:setAction"),"refund",{id:e.ProductAction.TransactionId}),w(e.EventDataType,t,r);else if(e.ProductAction.ProductActionType==mParticle.ProductActionType.AddToCart||e.ProductAction.ProductActionType==mParticle.ProductActionType.RemoveFromCart){var i={};e.ProductAction.ProductList.forEach(function(e){C(e.Attributes,i,S),A(e,i)}),ga(y("ec:setAction"),e.ProductAction.ProductActionType==mParticle.ProductActionType.AddToCart?"add":"remove"),w(e.EventDataType,t,r)}else e.ProductAction.ProductActionType==mParticle.ProductActionType.Checkout?(e.ProductAction.ProductList.forEach(function(e){var t={};C(e.Attributes,t,S),A(e,t)}),ga(y("ec:setAction"),"checkout",{step:e.ProductAction.CheckoutStep,option:e.ProductAction.CheckoutOptions}),w(e.EventDataType,t,r)):e.ProductAction.ProductActionType==mParticle.ProductActionType.Click?(e.ProductAction.ProductList.forEach(function(e){var t={};C(e.Attributes,t,S),A(e,t)}),ga(y("ec:setAction"),"click"),w(e.EventDataType,t,r)):e.ProductAction.ProductActionType==mParticle.ProductActionType.ViewDetail&&(e.ProductAction.ProductList.forEach(function(e){C(e.Attributes,{},S),A(e)}),ga(y("ec:setAction"),"detail"),ga(y("send"),r&&r[d]?r[d]:"event","eCommerce",h(e.EventCategory),t))}function T(e,t){var r=t.customDimensions[b(e.value)];r&&console.log("Warning: both "+r+" & "+e.map+" are mapped to "+e.value+". "+e.map+" is replacing "+r+". If this is a mistake, please revisit the Google Analytics settings at app.mparticle.com. Otherwise, please ignore this warning.")}g.name=r,this.init=function(o,a,s,c){try{if(e=o,i=a,isTesting=s,v=c||"mpgaTracker"+n++,"True"==e.classicMode)t._gaq=t._gaq||[],!0!==s&&(t._gaq.push(["_setAccount",e.apiKey]),"True"==e.useLocalhostCookie&&t._gaq.push(["_setDomainName","none"]),function(){var t=document.createElement("script");t.type="text/javascript",t.async=!0,"True"==e.useDisplayFeatures?t.src=("https:"==document.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js":t.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(t,r)}());else{!0!==s&&(g=t,f=document,h="script",C="ga",g.GoogleAnalyticsObject=C,g.ga=g.ga||function(){(g.ga.q=g.ga.q||[]).push(arguments)},g.ga.l=1*new Date,A=f.createElement(h),w=f.getElementsByTagName(h)[0],A.async=1,A.src="//www.google-analytics.com/analytics.js",w.parentNode.insertBefore(A,w));var u={trackingId:e.apiKey,name:v};if("True"==e.useLocalhostCookie&&(u.cookieDomain="none"),"AMP"===e.clientIdentificationType&&(u.useAmpClientId=!0),ga("create",u),"True"==e.useDisplayFeatures&&ga(y("require"),"displayfeatures"),"True"==e.useSecure&&ga(y("set"),"forceSSL",!0),e.customDimensions){var l=JSON.parse(e.customDimensions.replace(/&quot;/g,'"'));l.forEach(function(e){"EventAttributeClass.Name"===e.maptype?(T(e,p),p.customDimensions[b(e.value)]=e.map):"UserAttributeClass.Name"===e.maptype?(T(e,P),P.customDimensions[b(e.value)]=e.map):"ProductAttributeSelector.Name"===e.maptype&&(T(e,S),S.customDimensions[b(e.value)]=e.map)})}if(e.customMetrics){var d=JSON.parse(e.customMetrics.replace(/&quot;/g,'"'));d.forEach(function(e){"EventAttributeClass.Name"===e.maptype?(T(e,p),p.customMetrics[b(e.value)]=e.map):"UserAttributeClass.Name"===e.maptype?(T(e,P),P.customMetrics[b(e.value)]=e.map):"ProductAttributeSelector.Name"===e.maptype&&(T(e,S),S.customMetrics[b(e.value)]=e.map)})}}return m=!0,"Successfully initialized: "+r}catch(e){return"Failed to initialize: "+r}var g,f,h,C,A,w},this.process=function(t){var n={},f=!1;if(m){t.ExpandedEventCount=0,function(e,t){e.EventAttributes&&Object.keys(e.EventAttributes).length&&C(e.EventAttributes,t,p),e.UserAttributes&&Object.keys(e.UserAttributes).length&&C(e.UserAttributes,t,P)}(t,n),t.CustomFlags&&Object.keys(t.CustomFlags).length&&function(e,t){e.hasOwnProperty(a)&&(t.nonInteraction=e[a])}(t.CustomFlags,n);try{return t.EventDataType==o.PageView?(function(t,r,i){"True"==e.classicMode?_gaq.push(["_trackPageview"]):(t.CustomFlags&&t.CustomFlags[u]&&ga(y("set"),"page",t.CustomFlags[u]),ga(y("send"),i&&i[d]?i[d]:"pageview",r))}(t,n,t.CustomFlags),f=!0):t.EventDataType==o.Commerce?(I(t,n,t.CustomFlags),f=!0):t.EventDataType==o.PageEvent&&(f=!0,function(t,r,i){var o,n="",a=h(t.EventCategory);if(t.EventAttributes&&(t.EventAttributes.label&&(n=t.EventAttributes.label),t.EventAttributes.value&&(o=parseInt(t.EventAttributes.value,10))!=o&&(o=null),t.EventAttributes.category&&(a=t.EventAttributes.category)),t.CustomFlags){var u=t.CustomFlags[s],g=t.CustomFlags[c],m=parseInt(t.CustomFlags[l],10);u&&(a=u),g&&(n=g),m==m&&(o=m)}"True"==e.classicMode?_gaq.push(["_trackEvent",a,t.EventName,n,o]):ga(y("send"),i&&i[d]?i[d]:"event",a,t.EventName,n,o,r)}(t,n,t.CustomFlags)),f&&i&&i(g,t),"Successfully sent to "+r}catch(e){return"Failed to send to: "+r+" "+e}}return"Can't send to forwarder "+r+", not initialized"},this.setUserIdentity=function(i,o){if(!m)return"Can't call setUserIdentity on forwarder "+r+", not initialized";"True"==e.useCustomerId&&o==t.mParticle.IdentityType.CustomerId&&("True"==e.classicMode||ga(y("set"),"userId",t.mParticle.generateHash(i)))}};t&&t.mParticle&&t.mParticle.addForwarder&&(t.mParticle.addForwarder({name:r,constructor:g,getId:function(){return i}}),e.exports={register:function(e){e.kits&&(e.kits[r]={constructor:g})}})}(window)}),r=t.register;e.default=t,e.register=r,Object.defineProperty(e,"__esModule",{value:!0})}(t)},,function(e,t,r){var i=r(3),o=r(2),n=r(0);e.exports={getFilteredMparticleUser:function(e,t){return{getUserIdentities:function(){var r={},a=i.getUserIdentities(e);for(var s in a)a.hasOwnProperty(s)&&(r[o.IdentityType.getIdentityName(n.parseNumber(s))]=a[s]);return{userIdentities:r=n.filterUserIdentitiesForForwarders(r,t.userIdentityFilters)}},getMPID:function(){return e},getUserAttributesLists:function(e){var t,r={};for(var i in t=this.getAllUserAttributes())t.hasOwnProperty(i)&&Array.isArray(t[i])&&(r[i]=t[i].slice());return r=n.filterUserAttributes(r,e.userAttributeFilters)},getAllUserAttributes:function(){var r={},o=i.getAllUserAttributes(e);if(o)for(var a in o)o.hasOwnProperty(a)&&(Array.isArray(o[a])?r[a]=o[a].slice():r[a]=o[a]);return r=n.filterUserAttributes(r,t.userAttributeFilters)}}}}},function(e,t,r){var i=r(1),o=r(0),n=o.Validators;e.exports=function(e,t){var r={isEnabled:!0,sessionAttributes:{},currentSessionMPIDs:[],consentState:null,sessionId:null,isFirstRun:null,clientId:null,deviceId:null,devToken:null,migrationData:{},serverSettings:{},dateLastEventSent:null,sessionStartDate:null,currentPosition:null,isTracking:!1,watchPositionId:null,cartProducts:[],eventQueue:[],currencyCode:null,globalTimer:null,context:"",identityCallInFlight:!1,SDKConfig:{},migratingToIDSyncCookies:!1,nonCurrentUserMPIDs:{},identifyCalled:!1,isLoggedIn:!1,cookieSyncDates:{},integrationAttributes:{},requireDelay:!0,isLocalStorageAvailable:null,storageName:null,prodStorageName:null,activeForwarders:[],kits:{},configuredForwarders:[],pixelConfigurations:[]};for(var a in r)this[a]=r[a];if(this.storageName=o.createMainStorageName(e.workspaceToken),this.prodStorageName=o.createProductStorageName(e.workspaceToken),this.integrationDelayTimeoutStart=Date.now(),this.SDKConfig=function(e){var t={};for(var r in i.DefaultConfig)i.DefaultConfig.hasOwnProperty(r)&&(t[r]=i.DefaultConfig[r]);if(e)for(r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);for(r in i.DefaultUrls)t[r]=i.DefaultUrls[r];return t}(e),e){if(e.hasOwnProperty("isDevelopmentMode")?this.SDKConfig.isDevelopmentMode=o.returnConvertedBoolean(e.isDevelopmentMode):this.SDKConfig.isDevelopmentMode=!1,e.hasOwnProperty("serviceUrl")&&(this.SDKConfig.serviceUrl=e.serviceUrl),e.hasOwnProperty("secureServiceUrl")&&(this.SDKConfig.secureServiceUrl=e.secureServiceUrl),e.hasOwnProperty("v2ServiceUrl")&&(this.SDKConfig.v2ServiceUrl=e.v2ServiceUrl),e.hasOwnProperty("v2SecureServiceUrl")&&(this.SDKConfig.v2SecureServiceUrl=e.v2SecureServiceUrl),e.hasOwnProperty("identityUrl")&&(this.SDKConfig.identityUrl=e.identityUrl),e.hasOwnProperty("aliasUrl")&&(this.SDKConfig.aliasUrl=e.aliasUrl),e.hasOwnProperty("configUrl")&&(this.SDKConfig.configUrl=e.configUrl),e.hasOwnProperty("logLevel")&&(this.SDKConfig.logLevel=e.logLevel),e.hasOwnProperty("useNativeSdk")?this.SDKConfig.useNativeSdk=e.useNativeSdk:this.SDKConfig.useNativeSdk=!1,e.hasOwnProperty("kits")&&(this.SDKConfig.kits=e.kits),e.hasOwnProperty("isIOS")?this.SDKConfig.isIOS=e.isIOS:this.SDKConfig.isIOS=mParticle.isIOS||!1,e.hasOwnProperty("useCookieStorage")?this.SDKConfig.useCookieStorage=e.useCookieStorage:this.SDKConfig.useCookieStorage=!1,e.hasOwnProperty("maxProducts")?this.SDKConfig.maxProducts=e.maxProducts:this.SDKConfig.maxProducts=i.DefaultConfig.maxProducts,e.hasOwnProperty("maxCookieSize")?this.SDKConfig.maxCookieSize=e.maxCookieSize:this.SDKConfig.maxCookieSize=i.DefaultConfig.maxCookieSize,e.hasOwnProperty("appName")&&(this.SDKConfig.appName=e.appName),e.hasOwnProperty("integrationDelayTimeout")?this.SDKConfig.integrationDelayTimeout=e.integrationDelayTimeout:this.SDKConfig.integrationDelayTimeout=i.DefaultConfig.integrationDelayTimeout,e.hasOwnProperty("identifyRequest")&&(this.SDKConfig.identifyRequest=e.identifyRequest),e.hasOwnProperty("identityCallback")){var s=e.identityCallback;n.isFunction(s)?this.SDKConfig.identityCallback=e.identityCallback:t.warning("The optional callback must be a function. You tried entering a(n) "+typeof s," . Callback not set. Please set your callback again.")}e.hasOwnProperty("appVersion")&&(this.SDKConfig.appVersion=e.appVersion),e.hasOwnProperty("sessionTimeout")&&(this.SDKConfig.sessionTimeout=e.sessionTimeout),e.hasOwnProperty("forceHttps")?this.SDKConfig.forceHttps=e.forceHttps:this.SDKConfig.forceHttps=!0,e.hasOwnProperty("customFlags")&&(this.SDKConfig.customFlags=e.customFlags),e.hasOwnProperty("workspaceToken")?this.SDKConfig.workspaceToken=e.workspaceToken:t.warning("You should have a workspaceToken on your mParticle.config object for security purposes."),e.hasOwnProperty("requiredWebviewBridgeName")?this.SDKConfig.requiredWebviewBridgeName=e.requiredWebviewBridgeName:e.hasOwnProperty("workspaceToken")&&(this.SDKConfig.requiredWebviewBridgeName=e.workspaceToken),e.hasOwnProperty("minWebviewBridgeVersion")?this.SDKConfig.minWebviewBridgeVersion=e.minWebviewBridgeVersion:this.SDKConfig.minWebviewBridgeVersion=1,e.hasOwnProperty("aliasMaxWindow")?this.SDKConfig.aliasMaxWindow=e.aliasMaxWindow:this.SDKConfig.aliasMaxWindow=i.DefaultConfig.aliasMaxWindow}}},function(e,t){function r(){this.verbose=function(e){window.console&&window.console.info&&window.console.info(e)},this.error=function(e){window.console&&window.console.error&&window.console.error(e)},this.warning=function(e){window.console&&window.console.warn&&window.console.warn(e)}}e.exports=function(e){var t=e.logLevel||"warning";e.hasOwnProperty("logger")?this.logger=e.logger:this.logger=new r,this.verbose=function(e){"none"!==t&&this.logger.verbose&&"verbose"===t&&this.logger.verbose(e)},this.warning=function(e){"none"!==t&&(!this.logger.warning||"verbose"!==t&&"warning"!==t||this.logger.warning(e))},this.error=function(e){"none"!==t&&this.logger.error&&this.logger.error(e)},this.setLogLevel=function(e){t=e}}},function(e,t,r){var i=r(3),o=r(1),n=o.StorageNames,a=r(0),s=o.SDKv2NonMPIDCookieKeys,c=r(8).Base64,u={das:1},l={ui:1};function d(e,t){var r,a,s=new Date,c=i.getCookieDomain();r=new Date(s.getTime()+24*n.CookieExpiration*60*60*1e3).toGMTString(),a=""===c?"":";domain="+c,mParticle.Logger.verbose(o.Messages.InformationMessages.CookieSet),window.document.cookie=encodeURIComponent(mParticle.Store.storageName)+"="+e+";expires="+r+";path=/"+a,i.expireCookies(t),mParticle.Store.migratingToIDSyncCookies=!0}function g(e){e=i.replacePipesWithCommas(i.replaceApostrophesWithQuotes(e));var t=JSON.parse(e),r=JSON.parse(function(e){try{var t={gs:{csm:[]}};for(var r in e=JSON.parse(e))e.hasOwnProperty(r)&&(u[r]?t.gs[r]=e[r]:"mpid"===r?t.cu=e[r]:e.mpid&&(t[e.mpid]=t[e.mpid]||{},l[r]&&(t[e.mpid][r]=e[r])));return JSON.stringify(t)}catch(e){mParticle.Logger.error("Failed to restructure previous cookie into most current cookie schema")}}(e));return t.mpid&&(r.gs.csm.push(t.mpid),r.gs.csm=c.encode(JSON.stringify(r.gs.csm)),f(t,t.mpid)),JSON.stringify(r)}function m(){var e=n.localStorageProductsV4,t=localStorage.getItem(n.localStorageProductsV4);localStorage.setItem(mParticle.Store.prodStorageName,t),localStorage.removeItem(e)}function f(e,t){if(mParticle.Store.isLocalStorageAvailable){var r={};if(r[t]={},e.cp){try{r[t].cp=JSON.parse(c.decode(e.cp))}catch(i){r[t].cp=e.cp}Array.isArray(r[t].cp)||(r[t].cp=[])}localStorage.setItem(mParticle.Store.prodStorageName,c.encode(JSON.stringify(r)))}}e.exports={migrate:function(){try{!function(){var e,t,r,i,s,c=window.document.cookie.split("; ");for(mParticle.Logger.verbose(o.Messages.InformationMessages.CookieSearch),e=0,t=c.length;e<t;e++){if(r=c[e].split("="),i=a.decoded(r.shift()),s=a.decoded(r.join("=")),i===mParticle.Store.storageName)return;if(i===n.cookieNameV4)return d(s,n.cookieNameV4),void(mParticle.Store.isLocalStorageAvailable&&m());if(i===n.cookieNameV3){d(g(s),n.cookieNameV3);break}}}()}catch(e){i.expireCookies(n.cookieNameV3),i.expireCookies(n.cookieNameV4),mParticle.Logger.error("Error migrating cookie: "+e)}if(mParticle.Store.isLocalStorageAvailable)try{!function(){var e,t,r,o,a=n.localStorageNameV3,s=n.localStorageNameV4;if(!window.localStorage.getItem(mParticle.Store.storageName)){if(t=window.localStorage.getItem(s))return c(t,s),void m();if(r=window.localStorage.getItem(a)){if(mParticle.Store.migratingToIDSyncCookies=!0,o=r.slice(),(r=JSON.parse(i.replacePipesWithCommas(i.replaceApostrophesWithQuotes(r)))).mpid)return r=JSON.parse(g(o)),void c(JSON.stringify(r),a);if((r.cp||r.pb)&&!r.mpid)return(e=i.getCookie())?(f(r,e.cu),void localStorage.removeItem(n.localStorageNameV3)):void localStorage.removeItem(n.localStorageNameV3)}}function c(e,t){try{window.localStorage.setItem(encodeURIComponent(mParticle.Store.storageName),e)}catch(e){mParticle.Logger.error("Error with setting localStorage item.")}window.localStorage.removeItem(encodeURIComponent(t))}}()}catch(e){localStorage.removeItem(n.localStorageNameV3),localStorage.removeItem(n.localStorageNameV4),mParticle.Logger.error("Error migrating localStorage: "+e)}},convertUIFromArrayToObject:function(e){try{if(e&&a.isObject(e))for(var t in e)e.hasOwnProperty(t)&&(s[t]||e[t].ui&&Array.isArray(e[t].ui)&&(e[t].ui=e[t].ui.reduce(function(e,t){return t.Type&&a.Validators.isStringOrNumber(t.Identity)&&(e[t.Type]=t.Identity),e},{})));return e}catch(e){mParticle.Logger.error("An error ocurred when converting the user identities array to an object",e)}},convertSDKv1CookiesV3ToSDKv2CookiesV4:g}},function(e,t,r){var i=r(4),o=r(0),n=r(6),a=r(3);e.exports={startForwardingStatsTimer:function(){mParticle._forwardingStatsTimer=setInterval(function(){!function(){var e=n.getForwarderStatsQueue(),t=a.forwardingStatsBatches.uploadsTable,r=Date.now();for(var s in e.length&&(t[r]={uploading:!1,data:e},n.setForwarderStatsQueue([])),t)!function(e){if(t.hasOwnProperty(e)&&!1===t[e].uploading){var r=o.createXHR(function(){4===r.readyState&&(200===r.status||202===r.status?(mParticle.Logger.verbose("Successfully sent  "+r.statusText+" from server"),delete t[e]):"4"===r.status.toString()[0]?429!==r.status&&delete t[e]:t[e].uploading=!1)}),n=t[e].data;t[e].uploading=!0,i.sendBatchForwardingStatsToServer(n,r)}}(s)}()},mParticle.Store.SDKConfig.forwarderStatsTimeout)}}},function(e,t,r){"use strict";r.r(t);var i=r(11),o=r.n(i),n=r(16),a={isDevelopment:!1};r.n(n).a.register(a),o.a.init("REPLACEME",a),window.mParticle.ready(function(){window.performance.mark("mark_mparticle_fully_loaded"),o.a.logEvent("Example event!"),console.log("mParticle self-hosted has loaded!")})}]);